/**
 * @fileoverview added by tsickle
 * Generated from: lib/st-pagination/st-pagination.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * © 2017 Stratio Big Data Inc., Sucursal en España.
 *
 * This software is licensed under the Apache License, Version 2.0.
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the terms of the License for more details.
 *
 * SPDX-License-Identifier: Apache-2.0.
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, Output, ElementRef } from '@angular/core';
/**
 * \@description {Component} [Table]
 *
 * The pagination component has been designed to allow content to be displayed per pages. This informs user about the
 * number of the current page, the items displayed per page and the total of items. Moreover, when there are a lot of
 * items, it allows user to customize the number of items displayed per page.
 *
 * It is made by two sub-components:
 * - A range selector, that allows the user provides a dropdown to set how many items he wants to be displayed per page.
 * - A page navigation control, in order to let the user where he is and where he can go to.
 *
 * * \@model
 *
 *   [Paginate] {./st-pagination.interface.ts#Paginate}
 *   [PaginateOptions] {./st-pagination.interface.ts#PaginateOptions}
 *   [PaginateTexts] {./st-pagination.interface.ts#PaginateTexts}
 *   [PaginateTextsSchema] {./st-pagination.interface.ts#PaginateTextsSchema}
 *   [PaginateIconClasses] {./st-pagination.interface.ts#PaginateIconClasses}
 *
 * \@example
 *
 * {html}
 *
 * ```
 * <div class="pagination">
 *     <st-pagination [total]="items.length" [perPage]="perPage" [currentPage]="page" [id]="'pagination-demo'"
 *     (change)="onChangePage($event)">
 *     </st-pagination>
 *     </div>
 * ```
 *
 */
var StPaginationComponent = /** @class */ (function () {
    function StPaginationComponent(_cd, _paginationElement) {
        this._cd = _cd;
        this._paginationElement = _paginationElement;
        /**
         * \@Input {number} [perPage=20] The maximum number of items displayed per page
         */
        this.perPage = 20;
        /**
         * \@Input {PaginateTexts} [label={element: 'Rows', perPage: 'per page', of: 'of'}] Translated texts displayed at the pagination
         */
        this.label = {
            element: 'Rows', perPage: 'per page', of: 'of'
        };
        /**
         * \@Input {PaginateOptions[]}
         * [perPageOptions=Array( Object( value: 20, showFrom: 0 ),Object( value: 50, showFrom: 50 ), Object( value: 200, showFrom: 200 ))]
         *  List of options displayed at a selector where user can change the number of items displayed per page
         */
        this.perPageOptions = [
            { value: 20, showFrom: 0 }, { value: 50, showFrom: 50 }, { value: 200, showFrom: 200 }
        ];
        /**
         * \@Input {PaginateIconClasses} [iconClasses=Object(previous='', next='')] Icon classes for previous and next page buttons
         */
        this.iconClasses = { previous: 'icon-arrow2_left', next: 'icon-arrow2_right' };
        /**
         * \@Output {Paginate} [change=''] Event emitted when user interacts with some of the elements in the pagination.
         *  This sends the new pagination status (current page and items per page)
         */
        this.change = new EventEmitter();
        /**
         * \@Output {PaginateOptions} [changePerPage='']  Event emitted when user interacts with some of the elements in the selector of items displayed per page.
         * This sends the current items per page.
         */
        this.changePerPage = new EventEmitter();
        this.disableNextButton = false;
        this.disablePrevButton = true;
        this.items = [];
        this._currentPage = 1;
    }
    Object.defineProperty(StPaginationComponent.prototype, "currentPage", {
        /** @Input {number} [currentPage=1] Number of the current page */
        get: /**
         * \@Input {number} [currentPage=1] Number of the current page
         * @return {?}
         */
        function () {
            return this._currentPage;
        },
        set: /**
         * @param {?} currentPage
         * @return {?}
         */
        function (currentPage) {
            this._currentPage = currentPage;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StPaginationComponent.prototype, "hasOptions", {
        get: /**
         * @return {?}
         */
        function () {
            return this.items && this.items.length > 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StPaginationComponent.prototype, "paginationId", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var pagination = this._paginationElement.nativeElement;
            return pagination.getAttribute('id') !== null ? pagination.id : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StPaginationComponent.prototype, "selectId", {
        get: /**
         * @return {?}
         */
        function () {
            return this.paginationId !== null ? this.paginationId + "-select" : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StPaginationComponent.prototype, "buttonPrevId", {
        get: /**
         * @return {?}
         */
        function () {
            return this.paginationId !== null ? this.paginationId + "-prev" : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StPaginationComponent.prototype, "buttonNextId", {
        get: /**
         * @return {?}
         */
        function () {
            return this.paginationId !== null ? this.paginationId + "-next" : null;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    StPaginationComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.updatePages(false);
        this.generateItems();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    StPaginationComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.total && changes.total.previousValue !== changes.total.currentValue && !changes.total.firstChange) {
            this.generateItems();
            this.updatePages(false);
        }
        if (changes.currentPage && changes.currentPage.previousValue !== changes.currentPage.currentValue && !changes.currentPage.firstChange) {
            this._currentPage = changes.currentPage.currentValue;
            this.updatePages(false);
        }
        if (changes.perPage && changes.perPage.previousValue !== changes.perPage.currentValue && !changes.perPage.firstChange) {
            this.onChangePerPage(changes.perPage.currentValue);
        }
    };
    /**
     * @return {?}
     */
    StPaginationComponent.prototype.generateItems = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.items = [];
        this.perPageOptions.forEach(this.addPageOption.bind(this));
        if (this.items.length) {
            this.selectedItem = this.items.find((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.value === _this.perPage; })) || this.items[0];
        }
        this._cd.markForCheck();
    };
    /**
     * @return {?}
     */
    StPaginationComponent.prototype.nextPage = /**
     * @return {?}
     */
    function () {
        this.currentPage++;
        this.updatePages();
    };
    /**
     * @return {?}
     */
    StPaginationComponent.prototype.prevPage = /**
     * @return {?}
     */
    function () {
        this.currentPage--;
        this.updatePages();
    };
    /**
     * @param {?} perPage
     * @return {?}
     */
    StPaginationComponent.prototype.onChangePerPage = /**
     * @param {?} perPage
     * @return {?}
     */
    function (perPage) {
        var _this = this;
        if (perPage && typeof perPage === 'number') {
            this.currentPage = 1;
            this.perPage = perPage;
            this.updatePages();
            this.selectedItem = this.items.find((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.value === _this.perPage; }));
            this.changePerPage.emit(this.perPage);
        }
    };
    /**
     * @private
     * @param {?} option
     * @return {?}
     */
    StPaginationComponent.prototype.addPageOption = /**
     * @private
     * @param {?} option
     * @return {?}
     */
    function (option) {
        if (this.total && (!option.showFrom || option.showFrom <= this.total)) {
            this.items.push({
                label: "" + option.value,
                value: option.value
            });
        }
    };
    /**
     * @private
     * @param {?=} emit
     * @return {?}
     */
    StPaginationComponent.prototype.updatePages = /**
     * @private
     * @param {?=} emit
     * @return {?}
     */
    function (emit) {
        if (emit === void 0) { emit = true; }
        this.lastItem = this.perPage * this._currentPage;
        if (this.currentPage === 1) {
            this.firstItem = this._currentPage;
            this.disablePrevButton = true;
        }
        else {
            this.firstItem = this.perPage * (this._currentPage - 1) + 1;
            this.disablePrevButton = false;
        }
        if (this.lastItem >= this.total) {
            this.lastItem = this.total;
            this.disableNextButton = true;
        }
        else {
            this.disableNextButton = false;
        }
        if (emit) {
            this.change.emit({
                currentPage: this._currentPage,
                perPage: this.perPage
            });
        }
    };
    StPaginationComponent.decorators = [
        { type: Component, args: [{
                    selector: 'st-pagination',
                    template: "<!--\n\n    \u00A9 2017 Stratio Big Data Inc., Sucursal en Espa\u00F1a.\n\n    This software is licensed under the Apache License, Version 2.0.\n    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n    See the terms of the License for more details.\n\n    SPDX-License-Identifier: Apache-2.0.\n\n-->\n<div class=\"st-pagination pagination\">\n   <div *ngIf=\"hasOptions\" class=\"label st-pagination__per-page\">\n      <p class=\"st-pagination__label\">{{label.element}} {{label.perPage}}</p>\n      <st-select class=\"st-pagination__selector\" [options]=\"items\" [selected]=\"selectedItem\" (select)=\"onChangePerPage($event)\" [attr.id]=\"selectId\"></st-select>\n   </div>\n\n   <div class=\"label current-page-info\">\n      <p class=\"st-pagination__label\">{{firstItem}}-{{lastItem}} {{label.of || 'of'}} {{total}}</p>\n\n      <div class=\"buttons\">\n         <button class=\"button button-toolbar\" [attr.id]=\"buttonPrevId\" [disabled]=\"disablePrevButton\" type=\"button\" (click)=\"prevPage()\">\n            <i class=\"{{iconClasses?.previous || 'icon-arrow2_left'}}\"></i>\n         </button>\n         <button class=\"button button-toolbar\" [attr.id]=\"buttonNextId\" [disabled]=\"disableNextButton\" type=\"button\" (click)=\"nextPage()\">\n            <i class=\"{{iconClasses?.next || 'icon-arrow2_right'}}\"></i>\n         </button>\n      </div>\n   </div>\n</div>\n",
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: ["@charset \"UTF-8\";.pagination{display:flex;align-items:center;height:42px}.pagination .label{display:flex;align-items:center}.pagination .label p{margin:0;padding-right:15px}.pagination .current-page-info{flex:1;justify-content:flex-end}.pagination .st-pagination__selector{max-width:93px}.pagination button:first-child{margin:0 5px}"]
                }] }
    ];
    /** @nocollapse */
    StPaginationComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: ElementRef }
    ]; };
    StPaginationComponent.propDecorators = {
        perPage: [{ type: Input }],
        total: [{ type: Input }],
        label: [{ type: Input }],
        perPageOptions: [{ type: Input }],
        iconClasses: [{ type: Input }],
        change: [{ type: Output }],
        changePerPage: [{ type: Output }],
        currentPage: [{ type: Input }]
    };
    return StPaginationComponent;
}());
export { StPaginationComponent };
if (false) {
    /**
     * \@Input {number} [perPage=20] The maximum number of items displayed per page
     * @type {?}
     */
    StPaginationComponent.prototype.perPage;
    /**
     * \@Input {number} [total=''] Total of items
     * @type {?}
     */
    StPaginationComponent.prototype.total;
    /**
     * \@Input {PaginateTexts} [label={element: 'Rows', perPage: 'per page', of: 'of'}] Translated texts displayed at the pagination
     * @type {?}
     */
    StPaginationComponent.prototype.label;
    /**
     * \@Input {PaginateOptions[]}
     * [perPageOptions=Array( Object( value: 20, showFrom: 0 ),Object( value: 50, showFrom: 50 ), Object( value: 200, showFrom: 200 ))]
     *  List of options displayed at a selector where user can change the number of items displayed per page
     * @type {?}
     */
    StPaginationComponent.prototype.perPageOptions;
    /**
     * \@Input {PaginateIconClasses} [iconClasses=Object(previous='', next='')] Icon classes for previous and next page buttons
     * @type {?}
     */
    StPaginationComponent.prototype.iconClasses;
    /**
     * \@Output {Paginate} [change=''] Event emitted when user interacts with some of the elements in the pagination.
     *  This sends the new pagination status (current page and items per page)
     * @type {?}
     */
    StPaginationComponent.prototype.change;
    /**
     * \@Output {PaginateOptions} [changePerPage='']  Event emitted when user interacts with some of the elements in the selector of items displayed per page.
     * This sends the current items per page.
     * @type {?}
     */
    StPaginationComponent.prototype.changePerPage;
    /** @type {?} */
    StPaginationComponent.prototype.disableNextButton;
    /** @type {?} */
    StPaginationComponent.prototype.disablePrevButton;
    /** @type {?} */
    StPaginationComponent.prototype.firstItem;
    /** @type {?} */
    StPaginationComponent.prototype.lastItem;
    /** @type {?} */
    StPaginationComponent.prototype.items;
    /** @type {?} */
    StPaginationComponent.prototype.selectedItem;
    /**
     * @type {?}
     * @private
     */
    StPaginationComponent.prototype._currentPage;
    /**
     * @type {?}
     * @private
     */
    StPaginationComponent.prototype._cd;
    /**
     * @type {?}
     * @private
     */
    StPaginationComponent.prototype._paginationElement;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3QtcGFnaW5hdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac3RyYXRpby9lZ2VvLyIsInNvdXJjZXMiOlsibGliL3N0LXBhZ2luYXRpb24vc3QtcGFnaW5hdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBVUEsT0FBTyxFQUNKLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUVOLFVBQVUsRUFDWixNQUFNLGVBQWUsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBcUN2QjtJQTBERywrQkFBb0IsR0FBc0IsRUFDdEIsa0JBQThCO1FBRDlCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ3RCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBWTs7OztRQW5EekMsWUFBTyxHQUFXLEVBQUUsQ0FBQzs7OztRQU1yQixVQUFLLEdBQWtCO1lBQzdCLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxFQUFFLEVBQUUsSUFBSTtTQUNoRCxDQUFDOzs7Ozs7UUFNTyxtQkFBYyxHQUFzQjtZQUMxQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUU7U0FDeEYsQ0FBQzs7OztRQUdPLGdCQUFXLEdBQXdCLEVBQUMsUUFBUSxFQUFFLGtCQUFrQixFQUFFLElBQUksRUFBRSxtQkFBbUIsRUFBQyxDQUFDOzs7OztRQUs1RixXQUFNLEdBQTJCLElBQUksWUFBWSxFQUFZLENBQUM7Ozs7O1FBSzlELGtCQUFhLEdBQXlCLElBQUksWUFBWSxFQUFVLENBQUM7UUFZcEUsc0JBQWlCLEdBQVksS0FB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QUksQ0FBQyxpQkFBaUIsR0FBRyxLQUFLLENBQUM7U0FDakM7UUFFRCxJQUFJLElBQUksRUFBRTtZQUNQLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUNkLFdBQVcsRUFBRSxJQUFJLENBQUMsWUFBWTtnQkFDOUIsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO2FBQ3ZCLENBQUMsQ0FBQztTQUNMO0lBQ0osQ0FBQzs7Z0JBdEtILFNBQVMsU0FBQztvQkFDUixRQUFRLEVBQUUsZUFBZTtvQkFDekIsa2dEQUE2QztvQkFFN0MsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07O2lCQUNqRDs7OztnQkFuREUsaUJBQWlCO2dCQVFqQixVQUFVOzs7MEJBOENULEtBQUs7d0JBR0wsS0FBSzt3QkFHTCxLQUFLO2lDQVFMLEtBQUs7OEJBS0wsS0FBSzt5QkFLTCxNQUFNO2dDQUtOLE1BQU07OEJBR04sS0FBSzs7SUErSFQsNEJBQUM7Q0FBQSxBQXZLRCxJQXVLQztTQWpLWSxxQkFBcUI7Ozs7OztJQUUvQix3Q0FBOEI7Ozs7O0lBRzlCLHNDQUF1Qjs7Ozs7SUFHdkIsc0NBRUU7Ozs7Ozs7SUFNRiwrQ0FFRTs7Ozs7SUFHRiw0Q0FBc0c7Ozs7OztJQUt0Ryx1Q0FBd0U7Ozs7OztJQUt4RSw4Q0FBMkU7O0lBWTNFLGtEQUEwQzs7SUFDMUMsa0RBQXlDOztJQUN6QywwQ0FBeUI7O0lBQ3pCLHlDQUF3Qjs7SUFDeEIsc0NBQXdDOztJQUN4Qyw2Q0FBd0M7Ozs7O0lBRXhDLDZDQUFpQzs7Ozs7SUFFckIsb0NBQThCOzs7OztJQUM5QixtREFBc0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogwqkgMjAxNyBTdHJhdGlvIEJpZyBEYXRhIEluYy4sIFN1Y3Vyc2FsIGVuIEVzcGHDsWEuXG4gKlxuICogVGhpcyBzb2Z0d2FyZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTtcbiAqIHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuXG4gKiBTZWUgdGhlIHRlcm1zIG9mIHRoZSBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjAuXG4gKi9cbmltcG9ydCB7XG4gICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgQ29tcG9uZW50LFxuICAgRXZlbnRFbWl0dGVyLFxuICAgSW5wdXQsXG4gICBPbkNoYW5nZXMsXG4gICBPbkluaXQsXG4gICBPdXRwdXQsXG4gICBTaW1wbGVDaGFuZ2VzLFxuICAgRWxlbWVudFJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN0RHJvcERvd25NZW51SXRlbSB9IGZyb20gJy4uL3N0LWRyb3Bkb3duLW1lbnUvc3QtZHJvcGRvd24tbWVudS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUGFnaW5hdGUsIFBhZ2luYXRlT3B0aW9ucywgUGFnaW5hdGVUZXh0cyB9IGZyb20gJy4vc3QtcGFnaW5hdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUGFnaW5hdGVJY29uQ2xhc3NlcyB9IGZyb20gJy4vc3QtcGFnaW5hdGlvbi5pbnRlcmZhY2UnO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvbiB7Q29tcG9uZW50fSBbVGFibGVdXG4gKlxuICogVGhlIHBhZ2luYXRpb24gY29tcG9uZW50IGhhcyBiZWVuIGRlc2lnbmVkIHRvIGFsbG93IGNvbnRlbnQgdG8gYmUgZGlzcGxheWVkIHBlciBwYWdlcy4gVGhpcyBpbmZvcm1zIHVzZXIgYWJvdXQgdGhlXG4gKiBudW1iZXIgb2YgdGhlIGN1cnJlbnQgcGFnZSwgdGhlIGl0ZW1zIGRpc3BsYXllZCBwZXIgcGFnZSBhbmQgdGhlIHRvdGFsIG9mIGl0ZW1zLiBNb3Jlb3Zlciwgd2hlbiB0aGVyZSBhcmUgYSBsb3Qgb2ZcbiAqIGl0ZW1zLCBpdCBhbGxvd3MgdXNlciB0byBjdXN0b21pemUgdGhlIG51bWJlciBvZiBpdGVtcyBkaXNwbGF5ZWQgcGVyIHBhZ2UuXG4gKlxuICogSXQgaXMgbWFkZSBieSB0d28gc3ViLWNvbXBvbmVudHM6XG4gKiAtIEEgcmFuZ2Ugc2VsZWN0b3IsIHRoYXQgYWxsb3dzIHRoZSB1c2VyIHByb3ZpZGVzIGEgZHJvcGRvd24gdG8gc2V0IGhvdyBtYW55IGl0ZW1zIGhlIHdhbnRzIHRvIGJlIGRpc3BsYXllZCBwZXIgcGFnZS5cbiAqIC0gQSBwYWdlIG5hdmlnYXRpb24gY29udHJvbCwgaW4gb3JkZXIgdG8gbGV0IHRoZSB1c2VyIHdoZXJlIGhlIGlzIGFuZCB3aGVyZSBoZSBjYW4gZ28gdG8uXG4gKlxuICogKiBAbW9kZWxcbiAqXG4gKiAgIFtQYWdpbmF0ZV0gey4vc3QtcGFnaW5hdGlvbi5pbnRlcmZhY2UudHMjUGFnaW5hdGV9XG4gKiAgIFtQYWdpbmF0ZU9wdGlvbnNdIHsuL3N0LXBhZ2luYXRpb24uaW50ZXJmYWNlLnRzI1BhZ2luYXRlT3B0aW9uc31cbiAqICAgW1BhZ2luYXRlVGV4dHNdIHsuL3N0LXBhZ2luYXRpb24uaW50ZXJmYWNlLnRzI1BhZ2luYXRlVGV4dHN9XG4gKiAgIFtQYWdpbmF0ZVRleHRzU2NoZW1hXSB7Li9zdC1wYWdpbmF0aW9uLmludGVyZmFjZS50cyNQYWdpbmF0ZVRleHRzU2NoZW1hfVxuICogICBbUGFnaW5hdGVJY29uQ2xhc3Nlc10gey4vc3QtcGFnaW5hdGlvbi5pbnRlcmZhY2UudHMjUGFnaW5hdGVJY29uQ2xhc3Nlc31cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIHtodG1sfVxuICpcbiAqIGBgYFxuICogPGRpdiBjbGFzcz1cInBhZ2luYXRpb25cIj5cbiAqICAgICA8c3QtcGFnaW5hdGlvbiBbdG90YWxdPVwiaXRlbXMubGVuZ3RoXCIgW3BlclBhZ2VdPVwicGVyUGFnZVwiIFtjdXJyZW50UGFnZV09XCJwYWdlXCIgW2lkXT1cIidwYWdpbmF0aW9uLWRlbW8nXCJcbiAqICAgICAoY2hhbmdlKT1cIm9uQ2hhbmdlUGFnZSgkZXZlbnQpXCI+XG4gKiAgICAgPC9zdC1wYWdpbmF0aW9uPlxuICogICAgIDwvZGl2PlxuICogYGBgXG4gKlxuICovXG5AQ29tcG9uZW50KHtcbiAgIHNlbGVjdG9yOiAnc3QtcGFnaW5hdGlvbicsXG4gICB0ZW1wbGF0ZVVybDogJy4vc3QtcGFnaW5hdGlvbi5jb21wb25lbnQuaHRtbCcsXG4gICBzdHlsZVVybHM6IFsnLi9zdC1wYWdpbmF0aW9uLmNvbXBvbmVudC5zY3NzJ10sXG4gICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBTdFBhZ2luYXRpb25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gICAvKiogQElucHV0IHtudW1iZXJ9IFtwZXJQYWdlPTIwXSBUaGUgbWF4aW11bSBudW1iZXIgb2YgaXRlbXMgZGlzcGxheWVkIHBlciBwYWdlICovXG4gICBASW5wdXQoKSBwZXJQYWdlOiBudW1iZXIgPSAyMDtcblxuICAgLyoqIEBJbnB1dCB7bnVtYmVyfSBbdG90YWw9JyddIFRvdGFsIG9mIGl0ZW1zICovXG4gICBASW5wdXQoKSB0b3RhbDogbnVtYmVyO1xuXG4gICAvKiogQElucHV0IHtQYWdpbmF0ZVRleHRzfSBbbGFiZWw9e2VsZW1lbnQ6ICdSb3dzJywgcGVyUGFnZTogJ3BlciBwYWdlJywgb2Y6ICdvZid9XSBUcmFuc2xhdGVkIHRleHRzIGRpc3BsYXllZCBhdCB0aGUgcGFnaW5hdGlvbiAqL1xuICAgQElucHV0KCkgbGFiZWw6IFBhZ2luYXRlVGV4dHMgPSB7XG4gICAgICBlbGVtZW50OiAnUm93cycsIHBlclBhZ2U6ICdwZXIgcGFnZScsIG9mOiAnb2YnXG4gICB9O1xuXG4gICAvKiogQElucHV0IHtQYWdpbmF0ZU9wdGlvbnNbXX1cbiAgICAqIFtwZXJQYWdlT3B0aW9ucz1BcnJheSggT2JqZWN0KCB2YWx1ZTogMjAsIHNob3dGcm9tOiAwICksT2JqZWN0KCB2YWx1ZTogNTAsIHNob3dGcm9tOiA1MCApLCBPYmplY3QoIHZhbHVlOiAyMDAsIHNob3dGcm9tOiAyMDAgKSldXG4gICAgKiAgTGlzdCBvZiBvcHRpb25zIGRpc3BsYXllZCBhdCBhIHNlbGVjdG9yIHdoZXJlIHVzZXIgY2FuIGNoYW5nZSB0aGUgbnVtYmVyIG9mIGl0ZW1zIGRpc3BsYXllZCBwZXIgcGFnZVxuICAgICovXG4gICBASW5wdXQoKSBwZXJQYWdlT3B0aW9uczogUGFnaW5hdGVPcHRpb25zW10gPSBbXG4gICAgICB7IHZhbHVlOiAyMCwgc2hvd0Zyb206IDAgfSwgeyB2YWx1ZTogNTAsIHNob3dGcm9tOiA1MCB9LCB7IHZhbHVlOiAyMDAsIHNob3dGcm9tOiAyMDAgfVxuICAgXTtcblxuICAgLyoqIEBJbnB1dCB7UGFnaW5hdGVJY29uQ2xhc3Nlc30gW2ljb25DbGFzc2VzPU9iamVjdChwcmV2aW91cz0nJywgbmV4dD0nJyldIEljb24gY2xhc3NlcyBmb3IgcHJldmlvdXMgYW5kIG5leHQgcGFnZSBidXR0b25zICovXG4gICBASW5wdXQoKSBpY29uQ2xhc3NlczogUGFnaW5hdGVJY29uQ2xhc3NlcyA9IHtwcmV2aW91czogJ2ljb24tYXJyb3cyX2xlZnQnLCBuZXh0OiAnaWNvbi1hcnJvdzJfcmlnaHQnfTtcblxuICAgLyoqIEBPdXRwdXQge1BhZ2luYXRlfSBbY2hhbmdlPScnXSBFdmVudCBlbWl0dGVkIHdoZW4gdXNlciBpbnRlcmFjdHMgd2l0aCBzb21lIG9mIHRoZSBlbGVtZW50cyBpbiB0aGUgcGFnaW5hdGlvbi5cbiAgICAqICBUaGlzIHNlbmRzIHRoZSBuZXcgcGFnaW5hdGlvbiBzdGF0dXMgKGN1cnJlbnQgcGFnZSBhbmQgaXRlbXMgcGVyIHBhZ2UpXG4gICAgKi9cbiAgIEBPdXRwdXQoKSBjaGFuZ2U6IEV2ZW50RW1pdHRlcjxQYWdpbmF0ZT4gPSBuZXcgRXZlbnRFbWl0dGVyPFBhZ2luYXRlPigpO1xuXG4gICAvKiogQE91dHB1dCB7UGFnaW5hdGVPcHRpb25zfSBbY2hhbmdlUGVyUGFnZT0nJ10gIEV2ZW50IGVtaXR0ZWQgd2hlbiB1c2VyIGludGVyYWN0cyB3aXRoIHNvbWUgb2YgdGhlIGVsZW1lbnRzIGluIHRoZSBzZWxlY3RvciBvZiBpdGVtcyBkaXNwbGF5ZWQgcGVyIHBhZ2UuXG4gICAgKiBUaGlzIHNlbmRzIHRoZSBjdXJyZW50IGl0ZW1zIHBlciBwYWdlLlxuICAgICovXG4gICBAT3V0cHV0KCkgY2hhbmdlUGVyUGFnZTogRXZlbnRFbWl0dGVyPG51bWJlcj4gPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcblxuICAgLyoqIEBJbnB1dCB7bnVtYmVyfSBbY3VycmVudFBhZ2U9MV0gTnVtYmVyIG9mIHRoZSBjdXJyZW50IHBhZ2UgKi9cbiAgIEBJbnB1dCgpXG4gICBnZXQgY3VycmVudFBhZ2UoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50UGFnZTtcbiAgIH1cblxuICAgc2V0IGN1cnJlbnRQYWdlKGN1cnJlbnRQYWdlOiBudW1iZXIpIHtcbiAgICAgIHRoaXMuX2N1cnJlbnRQYWdlID0gY3VycmVudFBhZ2U7XG4gICB9XG5cbiAgIHB1YmxpYyBkaXNhYmxlTmV4dEJ1dHRvbjogYm9vbGVhbiA9IGZhbHNlO1xuICAgcHVibGljIGRpc2FibGVQcmV2QnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcbiAgIHB1YmxpYyBmaXJzdEl0ZW06IG51bWJlcjtcbiAgIHB1YmxpYyBsYXN0SXRlbTogbnVtYmVyO1xuICAgcHVibGljIGl0ZW1zOiBTdERyb3BEb3duTWVudUl0ZW1bXSA9IFtdO1xuICAgcHVibGljIHNlbGVjdGVkSXRlbTogU3REcm9wRG93bk1lbnVJdGVtO1xuXG4gICBwcml2YXRlIF9jdXJyZW50UGFnZTogbnVtYmVyID0gMTtcblxuICAgY29uc3RydWN0b3IocHJpdmF0ZSBfY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICAgICAgICAgcHJpdmF0ZSBfcGFnaW5hdGlvbkVsZW1lbnQ6IEVsZW1lbnRSZWYpIHtcbiAgIH1cblxuICAgZ2V0IGhhc09wdGlvbnMoKTogYm9vbGVhbiB7XG4gICAgICByZXR1cm4gdGhpcy5pdGVtcyAmJiB0aGlzLml0ZW1zLmxlbmd0aCA+IDE7XG4gICB9XG5cbiAgIGdldCBwYWdpbmF0aW9uSWQoKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgICBjb25zdCBwYWdpbmF0aW9uOiBIVE1MRWxlbWVudCA9IHRoaXMuX3BhZ2luYXRpb25FbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gICAgICByZXR1cm4gcGFnaW5hdGlvbi5nZXRBdHRyaWJ1dGUoJ2lkJykgIT09IG51bGwgPyBwYWdpbmF0aW9uLmlkIDogbnVsbDtcbiAgIH1cblxuICAgZ2V0IHNlbGVjdElkKCk6IHN0cmluZyB7XG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSWQgIT09IG51bGwgPyBgJHt0aGlzLnBhZ2luYXRpb25JZH0tc2VsZWN0YCA6IG51bGw7XG4gICB9XG5cbiAgIGdldCBidXR0b25QcmV2SWQoKTogc3RyaW5nIHtcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JZCAhPT0gbnVsbCA/IGAke3RoaXMucGFnaW5hdGlvbklkfS1wcmV2YCA6IG51bGw7XG4gICB9XG5cbiAgIGdldCBidXR0b25OZXh0SWQoKTogc3RyaW5nIHtcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JZCAhPT0gbnVsbCA/IGAke3RoaXMucGFnaW5hdGlvbklkfS1uZXh0YCA6IG51bGw7XG4gICB9XG5cbiAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgdGhpcy51cGRhdGVQYWdlcyhmYWxzZSk7XG4gICAgICB0aGlzLmdlbmVyYXRlSXRlbXMoKTtcbiAgIH1cblxuICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgICAgaWYgKGNoYW5nZXMudG90YWwgJiYgY2hhbmdlcy50b3RhbC5wcmV2aW91c1ZhbHVlICE9PSBjaGFuZ2VzLnRvdGFsLmN1cnJlbnRWYWx1ZSAmJiAhY2hhbmdlcy50b3RhbC5maXJzdENoYW5nZSkge1xuICAgICAgICAgdGhpcy5nZW5lcmF0ZUl0ZW1zKCk7XG4gICAgICAgICB0aGlzLnVwZGF0ZVBhZ2VzKGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIGlmIChjaGFuZ2VzLmN1cnJlbnRQYWdlICYmIGNoYW5nZXMuY3VycmVudFBhZ2UucHJldmlvdXNWYWx1ZSAhPT0gY2hhbmdlcy5jdXJyZW50UGFnZS5jdXJyZW50VmFsdWUgJiYgIWNoYW5nZXMuY3VycmVudFBhZ2UuZmlyc3RDaGFuZ2UpIHtcbiAgICAgICAgIHRoaXMuX2N1cnJlbnRQYWdlID0gY2hhbmdlcy5jdXJyZW50UGFnZS5jdXJyZW50VmFsdWU7XG4gICAgICAgICB0aGlzLnVwZGF0ZVBhZ2VzKGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIGlmIChjaGFuZ2VzLnBlclBhZ2UgJiYgY2hhbmdlcy5wZXJQYWdlLnByZXZpb3VzVmFsdWUgIT09IGNoYW5nZXMucGVyUGFnZS5jdXJyZW50VmFsdWUgJiYgIWNoYW5nZXMucGVyUGFnZS5maXJzdENoYW5nZSkge1xuICAgICAgICAgdGhpcy5vbkNoYW5nZVBlclBhZ2UoY2hhbmdlcy5wZXJQYWdlLmN1cnJlbnRWYWx1ZSk7XG4gICAgICB9XG4gICB9XG5cbiAgIGdlbmVyYXRlSXRlbXMoKTogdm9pZCB7XG4gICAgICB0aGlzLml0ZW1zID0gW107XG4gICAgICB0aGlzLnBlclBhZ2VPcHRpb25zLmZvckVhY2godGhpcy5hZGRQYWdlT3B0aW9uLmJpbmQodGhpcykpO1xuXG4gICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtID0gdGhpcy5pdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS52YWx1ZSA9PT0gdGhpcy5wZXJQYWdlKSB8fCB0aGlzLml0ZW1zWzBdO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9jZC5tYXJrRm9yQ2hlY2soKTtcbiAgIH1cblxuICAgbmV4dFBhZ2UoKTogdm9pZCB7XG4gICAgICB0aGlzLmN1cnJlbnRQYWdlKys7XG4gICAgICB0aGlzLnVwZGF0ZVBhZ2VzKCk7XG4gICB9XG5cbiAgIHByZXZQYWdlKCk6IHZvaWQge1xuICAgICAgdGhpcy5jdXJyZW50UGFnZS0tO1xuICAgICAgdGhpcy51cGRhdGVQYWdlcygpO1xuICAgfVxuXG4gICBvbkNoYW5nZVBlclBhZ2UocGVyUGFnZTogbnVtYmVyKTogdm9pZCB7XG4gICAgICBpZiAocGVyUGFnZSAmJiB0eXBlb2YgcGVyUGFnZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSAxO1xuICAgICAgICAgdGhpcy5wZXJQYWdlID0gcGVyUGFnZTtcbiAgICAgICAgIHRoaXMudXBkYXRlUGFnZXMoKTtcbiAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtID0gdGhpcy5pdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS52YWx1ZSA9PT0gdGhpcy5wZXJQYWdlKTtcbiAgICAgICAgIHRoaXMuY2hhbmdlUGVyUGFnZS5lbWl0KHRoaXMucGVyUGFnZSk7XG4gICAgICB9XG4gICB9XG5cbiAgIHByaXZhdGUgYWRkUGFnZU9wdGlvbihvcHRpb246IFBhZ2luYXRlT3B0aW9ucyk6IHZvaWQge1xuICAgICAgaWYgKHRoaXMudG90YWwgJiYgKCFvcHRpb24uc2hvd0Zyb20gfHwgb3B0aW9uLnNob3dGcm9tIDw9IHRoaXMudG90YWwpKSB7XG4gICAgICAgICB0aGlzLml0ZW1zLnB1c2goe1xuICAgICAgICAgICAgbGFiZWw6IGAke29wdGlvbi52YWx1ZX1gLFxuICAgICAgICAgICAgdmFsdWU6IG9wdGlvbi52YWx1ZVxuICAgICAgICAgfSk7XG4gICAgICB9XG4gICB9XG5cbiAgIHByaXZhdGUgdXBkYXRlUGFnZXMoZW1pdDogYm9vbGVhbiA9IHRydWUpOiB2b2lkIHtcbiAgICAgIHRoaXMubGFzdEl0ZW0gPSB0aGlzLnBlclBhZ2UgKiB0aGlzLl9jdXJyZW50UGFnZTtcblxuICAgICAgaWYgKHRoaXMuY3VycmVudFBhZ2UgPT09IDEpIHtcbiAgICAgICAgIHRoaXMuZmlyc3RJdGVtID0gdGhpcy5fY3VycmVudFBhZ2U7XG4gICAgICAgICB0aGlzLmRpc2FibGVQcmV2QnV0dG9uID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICB0aGlzLmZpcnN0SXRlbSA9IHRoaXMucGVyUGFnZSAqICh0aGlzLl9jdXJyZW50UGFnZSAtIDEpICsgMTtcbiAgICAgICAgIHRoaXMuZGlzYWJsZVByZXZCdXR0b24gPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMubGFzdEl0ZW0gPj0gdGhpcy50b3RhbCkge1xuICAgICAgICAgdGhpcy5sYXN0SXRlbSA9IHRoaXMudG90YWw7XG4gICAgICAgICB0aGlzLmRpc2FibGVOZXh0QnV0dG9uID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICB0aGlzLmRpc2FibGVOZXh0QnV0dG9uID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmIChlbWl0KSB7XG4gICAgICAgICB0aGlzLmNoYW5nZS5lbWl0KHtcbiAgICAgICAgICAgIGN1cnJlbnRQYWdlOiB0aGlzLl9jdXJyZW50UGFnZSxcbiAgICAgICAgICAgIHBlclBhZ2U6IHRoaXMucGVyUGFnZVxuICAgICAgICAgfSk7XG4gICAgICB9XG4gICB9XG59XG4iXX0=