/**
 * @fileoverview added by tsickle
 * Generated from: lib/st-form/st-form.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * © 2017 Stratio Big Data Inc., Sucursal en España.
 *
 * This software is licensed under the Apache License, Version 2.0.
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the terms of the License for more details.
 *
 * SPDX-License-Identifier: Apache-2.0.
 */
import { ChangeDetectionStrategy, Component, EventEmitter, forwardRef, Input, Output, ViewChild } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR, NgForm } from '@angular/forms';
import { FORM_UI_COMPONENT } from './shared/ui-component.interface';
/**
 * \@description {Component} [Dynamic form]
 *
 * The form component allows to generate forms dynamically using a JSON schema.
 *
 * \@example
 *
 * {html}
 *
 * ```
 * <st-form [schema]="jsonSchema" [(ngModel)]="model" #formModel="ngModel">
 * </st-form>
 *
 * ```
 *
 */
var StFormComponent = /** @class */ (function () {
    function StFormComponent() {
        /**
         * \@Input {string} [nestingLevel=0] This informs about the nesting level of the form. This input is only used for design purposes
         */
        this.nestingLevel = 0;
        /**
         * \@Input {string} [disabledSectionMessage='for this instance is disabled.']
         *  Message displayed when a section is disabled. This is always displayed after the section name
         */
        this.disabledSectionMessage = 'for this instance is disabled.';
        /**
         * \@Input {number} [sectionDescriptionLevel=-1] Level of the section to which description is displayed.
         * By default, section descriptions are not displayed.
         */
        this.sectionDescriptionLevel = -1;
        /**
         * \@Input {boolean} [showTooltips=-1] Enable or disable displaying of tooltips
         * By default, tooltips are displayed
         */
        this.showTooltips = true;
        /**
         * \@Output {any} [valueChange=] Event emitted when value is changed. This emits the current form value
         */
        this.valueChange = new EventEmitter();
        this.showCollapsedSectionFields = false;
        this.innerValue = {};
        this._value = {};
        this._parentFieldSubscription = [];
        this.onTouched = (/**
         * @return {?}
         */
        function () {
        });
    }
    Object.defineProperty(StFormComponent.prototype, "schema", {
        /** @Input {JSONSchema4 [schema=] JSON schema needed to generate the form */
        get: /**
         * \@Input {JSONSchema4 [schema=] JSON schema needed to generate the form
         * @return {?}
         */
        function () {
            return this._schema;
        },
        set: /**
         * @param {?} schema
         * @return {?}
         */
        function (schema) {
            this._schema = schema;
            this._value = {};
            if (this._schema.dependencies) {
                this._parentFields = Object.keys(this._schema.dependencies);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    StFormComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        if (!this.forceValidations) {
            this.form.form.markAsPristine();
        }
    };
    /**
     * @return {?}
     */
    StFormComponent.prototype.ngAfterViewChecked = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this._parentFields && this.form.control && this.form.control.controls) {
            var _loop_1 = function (i) {
                /** @type {?} */
                var parentField = this_1._parentFields[i];
                if (!this_1._parentFieldSubscription[i] && this_1.form.control.controls[parentField]) {
                    this_1._parentFieldSubscription[i] = this_1.form.control.controls[this_1._parentFields[i]].valueChanges.subscribe((/**
                     * @param {?} value
                     * @return {?}
                     */
                    function (value) {
                        if (!value) {
                            /** @type {?} */
                            var childrenFields = _this.schema.dependencies[parentField];
                            for (var j = 0; j < childrenFields.length; ++j) {
                                if (_this.form.controls[childrenFields[j]]) {
                                    _this._value[childrenFields[j]] = undefined;
                                }
                            }
                        }
                    }));
                }
            };
            var this_1 = this;
            for (var i = 0; i < this._parentFields.length; ++i) {
                _loop_1(i);
            }
        }
    };
    // Function to call when the value changes.
    // Function to call when the value changes.
    /**
     * @param {?} _
     * @return {?}
     */
    StFormComponent.prototype.onChange = 
    // Function to call when the value changes.
    /**
     * @param {?} _
     * @return {?}
     */
    function (_) {
    };
    /**
     * @param {?} control
     * @return {?}
     */
    StFormComponent.prototype.validate = /**
     * @param {?} control
     * @return {?}
     */
    function (control) {
        var _this = this;
        /** @type {?} */
        var errors = null;
        if (this.form) {
            Object.keys(this.form.controls).forEach((/**
             * @param {?} propertyName
             * @return {?}
             */
            function (propertyName) {
                if (_this.form.controls[propertyName] && _this.form.controls[propertyName].errors) {
                    if (!errors) {
                        errors = {};
                    }
                    errors[propertyName] = _this.form.controls[propertyName].errors;
                }
            }));
            this.form.control.setErrors(errors);
        }
        return errors;
    };
    /**
     * @param {?} propertyName
     * @return {?}
     */
    StFormComponent.prototype.isRequired = /**
     * @param {?} propertyName
     * @return {?}
     */
    function (propertyName) {
        return propertyName && this.schema.required && this.schema.required.indexOf(propertyName) !== -1;
    };
    /**
     * @return {?}
     */
    StFormComponent.prototype.isCollapsedSection = /**
     * @return {?}
     */
    function () {
        return this.schema.type === 'object' && this.schema.ui &&
            (this.schema.ui.component === FORM_UI_COMPONENT.SHOW_MORE || this.schema.ui.component === FORM_UI_COMPONENT.ACCORDION);
    };
    /**
     * @return {?}
     */
    StFormComponent.prototype.iShowMoreSection = /**
     * @return {?}
     */
    function () {
        return this.schema.type === 'object' && this.schema.ui && this.schema.ui.component === FORM_UI_COMPONENT.SHOW_MORE;
    };
    /**
     * @param {?} propertyName
     * @return {?}
     */
    StFormComponent.prototype.isAParentField = /**
     * @param {?} propertyName
     * @return {?}
     */
    function (propertyName) {
        return this.schema.dependencies && this.schema.dependencies[propertyName] && this.schema.dependencies[propertyName].length > 0;
    };
    /**
     * @return {?}
     */
    StFormComponent.prototype.getOptionalButtonLabel = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var label = 'Additional options';
        if (this.parentName || this.schema.title) {
            label += ' of ';
            label += this.parentName || this.schema.title;
        }
        return label;
    };
    /**
     * @return {?}
     */
    StFormComponent.prototype.onChangeOptionalFieldsVisibility = /**
     * @return {?}
     */
    function () {
        this.showCollapsedSectionFields = !this.showCollapsedSectionFields;
    };
    /**
     * @param {?} propertyName
     * @return {?}
     */
    StFormComponent.prototype.getFieldClasses = /**
     * @param {?} propertyName
     * @return {?}
     */
    function (propertyName) {
        return {
            'hidden': this.isCollapsedSection() && !this.showCollapsedSectionFields,
            'parent-field': this.isAParentField(propertyName) || (this.isASwitchSection() && this.isTheFirstField(propertyName))
        };
    };
    /**
     * @param {?} propertyName
     * @return {?}
     */
    StFormComponent.prototype.fieldHasToBeCreated = /**
     * @param {?} propertyName
     * @return {?}
     */
    function (propertyName) {
        /** @type {?} */
        var createField = true;
        /** @type {?} */
        var parentField = this.getParentField(propertyName);
        if (((parentField && !this._value[parentField]) || (this.isInADisabledSection() && !this.isTheFirstField(propertyName)))
            || !this.fulfillDependencyVisibility(propertyName)) {
            createField = false;
            this._value[propertyName] = undefined;
        }
        return createField;
    };
    /**
     * @param {?} propertyName
     * @return {?}
     */
    StFormComponent.prototype.isRelatedField = /**
     * @param {?} propertyName
     * @return {?}
     */
    function (propertyName) {
        return this.schema.properties[propertyName].ui && this.schema.properties[propertyName].ui.relatedTo;
    };
    // When value is received from outside
    // When value is received from outside
    /**
     * @param {?} value
     * @return {?}
     */
    StFormComponent.prototype.writeValue = 
    // When value is received from outside
    /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (value) {
            this.onChange(value);
            this.innerValue = value;
        }
    };
    /**
     * @param {?} value
     * @param {?} property
     * @return {?}
     */
    StFormComponent.prototype.onChangeProperty = /**
     * @param {?} value
     * @param {?} property
     * @return {?}
     */
    function (value, property) {
        var _this = this;
        this._value[property] = value;
        this.valueChange.emit(this._value);
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.onChange(_this._value);
        }));
    };
    // Registry the change function to propagate internal model changes
    // Registry the change function to propagate internal model changes
    /**
     * @param {?} fn
     * @return {?}
     */
    StFormComponent.prototype.registerOnChange = 
    // Registry the change function to propagate internal model changes
    /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onChange = fn;
    };
    // Registry the touch function to propagate internal touch events TODO: make this function.
    // Registry the touch function to propagate internal touch events TODO: make this function.
    /**
     * @param {?} fn
     * @return {?}
     */
    StFormComponent.prototype.registerOnTouched = 
    // Registry the touch function to propagate internal touch events TODO: make this function.
    /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onTouched = fn;
    };
    // Allows Angular to disable the form.
    // Allows Angular to disable the form.
    /**
     * @param {?} disable
     * @return {?}
     */
    StFormComponent.prototype.setDisabledState = 
    // Allows Angular to disable the form.
    /**
     * @param {?} disable
     * @return {?}
     */
    function (disable) {
        if (disable) {
            this.form.control.disable();
        }
        else {
            this.form.control.enable();
        }
    };
    /**
     * @return {?}
     */
    StFormComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this._parentFieldSubscription) {
            for (var i = 0; i < this._parentFieldSubscription.length; ++i) {
                this._parentFieldSubscription[i].unsubscribe();
            }
        }
    };
    /**
     * @return {?}
     */
    StFormComponent.prototype.isInADisabledSection = /**
     * @return {?}
     */
    function () {
        if (this.isASwitchSection()) {
            /** @type {?} */
            var sectionEnabler = Object.keys(this.schema.properties)[0];
            return !(this.form && this.form.controls[sectionEnabler] && this.form.controls[sectionEnabler].value);
        }
        return false;
    };
    /**
     * @return {?}
     */
    StFormComponent.prototype.isASwitchSection = /**
     * @return {?}
     */
    function () {
        return this.schema.ui && this.schema.ui.component === FORM_UI_COMPONENT.SWITCH;
    };
    /**
     * @return {?}
     */
    StFormComponent.prototype.isAnAccordion = /**
     * @return {?}
     */
    function () {
        return this.schema.ui && this.schema.ui.component === FORM_UI_COMPONENT.ACCORDION;
    };
    /**
     * @return {?}
     */
    StFormComponent.prototype.onClickTitle = /**
     * @return {?}
     */
    function () {
        if (this.isAnAccordion()) {
            this.onChangeOptionalFieldsVisibility();
        }
    };
    /**
     * @param {?} propertyName
     * @return {?}
     */
    StFormComponent.prototype.isTheFirstField = /**
     * @param {?} propertyName
     * @return {?}
     */
    function (propertyName) {
        return propertyName === Object.keys(this.schema.properties)[0];
    };
    /**
     * @private
     * @param {?} propertyName
     * @return {?}
     */
    StFormComponent.prototype.getParentField = /**
     * @private
     * @param {?} propertyName
     * @return {?}
     */
    function (propertyName) {
        var _this = this;
        /** @type {?} */
        var parentField = undefined;
        if (this.schema.dependencies) {
            Object.keys(this.schema.dependencies).forEach((/**
             * @param {?} key
             * @return {?}
             */
            function (key) {
                if (_this.schema.dependencies[key].indexOf(propertyName) !== -1) {
                    parentField = key;
                }
            }));
        }
        return parentField;
    };
    /**
     * @private
     * @param {?} propertyName
     * @return {?}
     */
    StFormComponent.prototype.fulfillDependencyVisibility = /**
     * @private
     * @param {?} propertyName
     * @return {?}
     */
    function (propertyName) {
        /** @type {?} */
        var fulfill = true;
        /** @type {?} */
        var propertySchema = this.schema.properties[propertyName];
        if (propertySchema.ui && propertySchema.ui.visible) {
            /** @type {?} */
            var keys = Object.keys(propertySchema.ui.visible);
            /** @type {?} */
            var i = 0;
            while (fulfill && i < keys.length && propertySchema.ui.visible.hasOwnProperty(keys[i])) {
                if (this._value[keys[i]] !== propertySchema.ui.visible[keys[i]]) {
                    fulfill = false;
                }
                ++i;
            }
        }
        return fulfill;
    };
    StFormComponent.decorators = [
        { type: Component, args: [{
                    selector: 'st-form',
                    template: "<!--\n\n    \u00A9 2017 Stratio Big Data Inc., Sucursal en Espa\u00F1a.\n\n    This software is licensed under the Apache License, Version 2.0.\n    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n    See the terms of the License for more details.\n\n    SPDX-License-Identifier: Apache-2.0.\n\n-->\n\n<form #form=\"ngForm\" *ngIf=\"innerValue\"\n      [ngClass]=\"{'category': nestingLevel === 0,\n                  'section': nestingLevel === 1,\n                  'subsection': nestingLevel > 1,\n                  'accordion': isAnAccordion(),\n                   'accordion--open': isAnAccordion() && showCollapsedSectionFields}\"\n      novalidate>\n   <h1 *ngIf=\"schema.title && !isASwitchSection()\" class=\"title\" (click)=\"onClickTitle()\">{{schema.title}}</h1>\n   <p *ngIf=\"schema.description && nestingLevel <= sectionDescriptionLevel\" class=\"description\">{{schema.description}}</p>\n   <span class=\"optional-fields-button\" *ngIf=\"iShowMoreSection()\">\n   <button class=\"button button-link\"\n           (click)=\"onChangeOptionalFieldsVisibility()\">\n      <span> <i\n         [ngClass]=\"{'icon-arrow2_down': showCollapsedSectionFields, 'icon-arrow2_right': !showCollapsedSectionFields}\"></i> {{getOptionalButtonLabel()}}</span>\n   </button>\n   </span>\n   <ng-container *ngFor=\"let property of schema.properties | stObjectToArray; let index = index;\">\n      <div class=\"form-field-container\">\n         <st-form-field *ngIf=\"property.value.type !== 'object' && fieldHasToBeCreated(property.key)\" class=\"form-field\"\n                        [schema]=\"property\"\n                        [name]=\"property.key\"\n                        [maxWidth]=\"textFieldMaxWidth\"\n                        [ngModel]=\"innerValue[property.key]\"\n                        [forceValidations]=\"forceValidations\"\n                        (ngModelChange)=\"onChangeProperty($event, property.key)\"\n                        [required]=\"isRequired(property.key)\"\n                        [hasDependencies]=\"isAParentField(property.key) || (isASwitchSection() && isTheFirstField(property.key))\"\n                        [ngClass]=\"getFieldClasses(property.key)\"\n                        [showTooltip]=\"showTooltips\"\n                        [qaTag]=\"property.key\"\n                        [errorMessages]=\"errorMessages\"\n                        [attr.id]=\"property.key + '-form-field'\">\n         </st-form-field>\n\n         <div *ngIf=\"property.value.type === 'object' && fieldHasToBeCreated(property.key)\">\n            <st-form\n               [hidden]=\"isCollapsedSection() && !showCollapsedSectionFields\"\n               [schema]=\"property.value\"\n               [parentName]=\"schema.title\"\n               [name]=\"property.key\"\n               [textFieldMaxWidth]=\"textFieldMaxWidth\"\n               [ngModel]=\"innerValue[property.key]\"\n               (ngModelChange)=\"onChangeProperty($event, property.key)\"\n               [attr.id]=\"property.key + '-section'\"\n               [nestingLevel]=\"nestingLevel + 1\"\n               [showTooltips]=\"showTooltips\"\n               [sectionDescriptionLevel]=\"sectionDescriptionLevel\"\n               [errorMessages]=\"errorMessages\">\n            </st-form>\n         </div>\n      </div>\n      <span class=\"line-break\" *ngIf=\"!isRelatedField(property.key)\"></span>\n   </ng-container>\n\n   <p *ngIf=\"isInADisabledSection()\" class=\"disabled-section-info\"> {{schema.title}} {{disabledSectionMessage}}</p>\n</form>\n",
                    host: { class: 'st-form' },
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [
                        { provide: NG_VALUE_ACCESSOR, useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return StFormComponent; })), multi: true },
                        { provide: NG_VALIDATORS, useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return StFormComponent; })), multi: true }
                    ],
                    styles: ["@charset \"UTF-8\";.form-field{display:block}.form-field.hidden{visibility:hidden;position:absolute}.section-title{padding:10px 0 20px}"]
                }] }
    ];
    StFormComponent.propDecorators = {
        parentName: [{ type: Input }],
        nestingLevel: [{ type: Input }],
        forceValidations: [{ type: Input }],
        disabledSectionMessage: [{ type: Input }],
        sectionDescriptionLevel: [{ type: Input }],
        textFieldMaxWidth: [{ type: Input }],
        errorMessages: [{ type: Input }],
        showTooltips: [{ type: Input }],
        valueChange: [{ type: Output }],
        form: [{ type: ViewChild, args: ['form', { static: false },] }],
        schema: [{ type: Input }]
    };
    return StFormComponent;
}());
export { StFormComponent };
if (false) {
    /**
     * \@Input {string} [parentName=] Name of the parent section. By default, it is undefined
     * @type {?}
     */
    StFormComponent.prototype.parentName;
    /**
     * \@Input {string} [nestingLevel=0] This informs about the nesting level of the form. This input is only used for design purposes
     * @type {?}
     */
    StFormComponent.prototype.nestingLevel;
    /**
     * \@Input {boolean} [forceValidations=] Boolean to force the field validations
     * @type {?}
     */
    StFormComponent.prototype.forceValidations;
    /**
     * \@Input {string} [disabledSectionMessage='for this instance is disabled.']
     *  Message displayed when a section is disabled. This is always displayed after the section name
     * @type {?}
     */
    StFormComponent.prototype.disabledSectionMessage;
    /**
     * \@Input {number} [sectionDescriptionLevel=-1] Level of the section to which description is displayed.
     * By default, section descriptions are not displayed.
     * @type {?}
     */
    StFormComponent.prototype.sectionDescriptionLevel;
    /**
     * \@Input {number} [textFieldMaxWidth=] Maximum width of a field needed to paint a input or textarea
     * @type {?}
     */
    StFormComponent.prototype.textFieldMaxWidth;
    /**
     * \@Input {StInputError} [errorMessages=] Field error translations
     * @type {?}
     */
    StFormComponent.prototype.errorMessages;
    /**
     * \@Input {boolean} [showTooltips=-1] Enable or disable displaying of tooltips
     * By default, tooltips are displayed
     * @type {?}
     */
    StFormComponent.prototype.showTooltips;
    /**
     * \@Output {any} [valueChange=] Event emitted when value is changed. This emits the current form value
     * @type {?}
     */
    StFormComponent.prototype.valueChange;
    /** @type {?} */
    StFormComponent.prototype.form;
    /** @type {?} */
    StFormComponent.prototype.showCollapsedSectionFields;
    /** @type {?} */
    StFormComponent.prototype.innerValue;
    /**
     * @type {?}
     * @private
     */
    StFormComponent.prototype._value;
    /**
     * @type {?}
     * @private
     */
    StFormComponent.prototype._parentFieldSubscription;
    /**
     * @type {?}
     * @private
     */
    StFormComponent.prototype._parentFields;
    /**
     * @type {?}
     * @private
     */
    StFormComponent.prototype._schema;
    /** @type {?} */
    StFormComponent.prototype.onTouched;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3QtZm9ybS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac3RyYXRpby9lZ2VvLyIsInNvdXJjZXMiOlsibGliL3N0LWZvcm0vc3QtZm9ybS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBVUEsT0FBTyxFQUdKLHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsWUFBWSxFQUNaLFVBQVUsRUFDVixLQUFLLEVBRUwsTUFBTSxFQUNOLFNBQVMsRUFDWCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXFDLGFBQWEsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUc3RyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQnBFO0lBQUE7Ozs7UUFnQlksaUJBQVksR0FBVyxDQUFDLENBQUM7Ozs7O1FBTXpCLDJCQUFzQixHQUFXLGdDQUFnQyxDQUFDOzs7OztRQUtsRSw0QkFBdUIsR0FBVyxDQUFDLENBQUMsQ0FBQzs7Ozs7UUFXckMsaUJBQVksR0FBWSxJQUFJLENBQUM7Ozs7UUFFNUIsZ0JBQVcsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUk1RCwrQkFBMEIsR0FBWSxLQUFLLENBQUM7UUFDNUMsZUFBVSxHQUFRLEVBQUUsQ0FBQztRQUNwQixXQUFNLEdBQVEsRUFBRSxDQUFDO1FBQ2pCLDZCQUF3QixHQUFtQixFQUFFLENBQUM7UUFnRHRELGNBQVM7OztRQUFHO1FBQ1osQ0FBQyxFQUFBO0lBeUtKLENBQUM7SUFyTkUsc0JBQWEsbUNBQU07UUFEbkIsNEVBQTRFOzs7OztRQUM1RTtZQUNHLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUN2QixDQUFDOzs7OztRQUVELFVBQVcsTUFBbUI7WUFDM0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFF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QkFBQztDQUFBLEFBelFELElBeVFDO1NBN1BZLGVBQWU7Ozs7OztJQUV6QixxQ0FBNEI7Ozs7O0lBRTVCLHVDQUFrQzs7Ozs7SUFFbEMsMkNBQW1DOzs7Ozs7SUFJbkMsaURBQTJFOzs7Ozs7SUFLM0Usa0RBQThDOzs7OztJQUc5Qyw0Q0FBbUM7Ozs7O0lBR25DLHdDQUFxQzs7Ozs7O0lBS3JDLHVDQUFzQzs7Ozs7SUFFdEMsc0NBQW1FOztJQUVuRSwrQkFBbUQ7O0lBRW5ELHFEQUFtRDs7SUFDbkQscUNBQTRCOzs7OztJQUM1QixpQ0FBeUI7Ozs7O0lBQ3pCLG1EQUFzRDs7Ozs7SUFDdEQsd0NBQWdDOzs7OztJQUNoQyxrQ0FBNkI7O0lBOEM3QixvQ0FDQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiDCqSAyMDE3IFN0cmF0aW8gQmlnIERhdGEgSW5jLiwgU3VjdXJzYWwgZW4gRXNwYcOxYS5cbiAqXG4gKiBUaGlzIHNvZnR3YXJlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZO1xuICogd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS5cbiAqIFNlZSB0aGUgdGVybXMgb2YgdGhlIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMC5cbiAqL1xuaW1wb3J0IHtcbiAgIEFmdGVyVmlld0NoZWNrZWQsXG4gICBBZnRlclZpZXdJbml0LFxuICAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gICBDb21wb25lbnQsXG4gICBFdmVudEVtaXR0ZXIsXG4gICBmb3J3YXJkUmVmLFxuICAgSW5wdXQsXG4gICBPbkRlc3Ryb3ksXG4gICBPdXRwdXQsXG4gICBWaWV3Q2hpbGRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgRm9ybUNvbnRyb2wsIE5HX1ZBTElEQVRPUlMsIE5HX1ZBTFVFX0FDQ0VTU09SLCBOZ0Zvcm0gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgRk9STV9VSV9DT01QT05FTlQgfSBmcm9tICcuL3NoYXJlZC91aS1jb21wb25lbnQuaW50ZXJmYWNlJztcbmltcG9ydCB7IEpTT05TY2hlbWE0IH0gZnJvbSAnanNvbi1zY2hlbWEnO1xuaW1wb3J0IHsgU3RJbnB1dEVycm9yIH0gZnJvbSAnLi4vc3QtaW5wdXQvc3QtaW5wdXQuZXJyb3IubW9kZWwnO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvbiB7Q29tcG9uZW50fSBbRHluYW1pYyBmb3JtXVxuICpcbiAqIFRoZSBmb3JtIGNvbXBvbmVudCBhbGxvd3MgdG8gZ2VuZXJhdGUgZm9ybXMgZHluYW1pY2FsbHkgdXNpbmcgYSBKU09OIHNjaGVtYS5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIHtodG1sfVxuICpcbiAqIGBgYFxuICogPHN0LWZvcm0gW3NjaGVtYV09XCJqc29uU2NoZW1hXCIgWyhuZ01vZGVsKV09XCJtb2RlbFwiICNmb3JtTW9kZWw9XCJuZ01vZGVsXCI+XG4gKiA8L3N0LWZvcm0+XG4gKlxuICogYGBgXG4gKlxuICovXG5AQ29tcG9uZW50KHtcbiAgIHNlbGVjdG9yOiAnc3QtZm9ybScsXG4gICB0ZW1wbGF0ZVVybDogJy4vc3QtZm9ybS5jb21wb25lbnQuaHRtbCcsXG4gICBzdHlsZVVybHM6IFsnLi9zdC1mb3JtLmNvbXBvbmVudC5zY3NzJ10sXG4gICBob3N0OiB7IGNsYXNzOiAnc3QtZm9ybScgfSxcbiAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgcHJvdmlkZXJzOiBbXG4gICAgICB7IHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLCB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBTdEZvcm1Db21wb25lbnQpLCBtdWx0aTogdHJ1ZSB9LFxuICAgICAgeyBwcm92aWRlOiBOR19WQUxJREFUT1JTLCB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBTdEZvcm1Db21wb25lbnQpLCBtdWx0aTogdHJ1ZSB9XG4gICBdXG59KVxuXG5leHBvcnQgY2xhc3MgU3RGb3JtQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uRGVzdHJveSB7XG4gICAvKiogQElucHV0IHtzdHJpbmd9IFtwYXJlbnROYW1lPV0gTmFtZSBvZiB0aGUgcGFyZW50IHNlY3Rpb24uIEJ5IGRlZmF1bHQsIGl0IGlzIHVuZGVmaW5lZCAqL1xuICAgQElucHV0KCkgcGFyZW50TmFtZTogc3RyaW5nO1xuICAgLyoqIEBJbnB1dCB7c3RyaW5nfSBbbmVzdGluZ0xldmVsPTBdIFRoaXMgaW5mb3JtcyBhYm91dCB0aGUgbmVzdGluZyBsZXZlbCBvZiB0aGUgZm9ybS4gVGhpcyBpbnB1dCBpcyBvbmx5IHVzZWQgZm9yIGRlc2lnbiBwdXJwb3NlcyAqL1xuICAgQElucHV0KCkgbmVzdGluZ0xldmVsOiBudW1iZXIgPSAwO1xuICAgLyoqIEBJbnB1dCB7Ym9vbGVhbn0gW2ZvcmNlVmFsaWRhdGlvbnM9XSBCb29sZWFuIHRvIGZvcmNlIHRoZSBmaWVsZCB2YWxpZGF0aW9ucyAqL1xuICAgQElucHV0KCkgZm9yY2VWYWxpZGF0aW9uczogYm9vbGVhbjtcbiAgIC8qKiBASW5wdXQge3N0cmluZ30gW2Rpc2FibGVkU2VjdGlvbk1lc3NhZ2U9J2ZvciB0aGlzIGluc3RhbmNlIGlzIGRpc2FibGVkLiddXG4gICAgKiAgTWVzc2FnZSBkaXNwbGF5ZWQgd2hlbiBhIHNlY3Rpb24gaXMgZGlzYWJsZWQuIFRoaXMgaXMgYWx3YXlzIGRpc3BsYXllZCBhZnRlciB0aGUgc2VjdGlvbiBuYW1lXG4gICAgKi9cbiAgIEBJbnB1dCgpIGRpc2FibGVkU2VjdGlvbk1lc3NhZ2U6IHN0cmluZyA9ICdmb3IgdGhpcyBpbnN0YW5jZSBpcyBkaXNhYmxlZC4nO1xuXG4gICAvKiogQElucHV0IHtudW1iZXJ9IFtzZWN0aW9uRGVzY3JpcHRpb25MZXZlbD0tMV0gTGV2ZWwgb2YgdGhlIHNlY3Rpb24gdG8gd2hpY2ggZGVzY3JpcHRpb24gaXMgZGlzcGxheWVkLlxuICAgICogQnkgZGVmYXVsdCwgc2VjdGlvbiBkZXNjcmlwdGlvbnMgYXJlIG5vdCBkaXNwbGF5ZWQuXG4gICAgKi9cbiAgIEBJbnB1dCgpIHNlY3Rpb25EZXNjcmlwdGlvbkxldmVsOiBudW1iZXIgPSAtMTtcblxuICAgLyoqIEBJbnB1dCB7bnVtYmVyfSBbdGV4dEZpZWxkTWF4V2lkdGg9XSBNYXhpbXVtIHdpZHRoIG9mIGEgZmllbGQgbmVlZGVkIHRvIHBhaW50IGEgaW5wdXQgb3IgdGV4dGFyZWEgKi9cbiAgIEBJbnB1dCgpIHRleHRGaWVsZE1heFdpZHRoOiBudW1iZXI7XG5cbiAgIC8qKiBASW5wdXQge1N0SW5wdXRFcnJvcn0gW2Vycm9yTWVzc2FnZXM9XSBGaWVsZCBlcnJvciB0cmFuc2xhdGlvbnMgKi9cbiAgIEBJbnB1dCgpIGVycm9yTWVzc2FnZXM6IFN0SW5wdXRFcnJvcjtcblxuICAgLyoqIEBJbnB1dCB7Ym9vbGVhbn0gW3Nob3dUb29sdGlwcz0tMV0gRW5hYmxlIG9yIGRpc2FibGUgZGlzcGxheWluZyBvZiB0b29sdGlwc1xuICAgICogQnkgZGVmYXVsdCwgdG9vbHRpcHMgYXJlIGRpc3BsYXllZFxuICAgICovXG4gICBASW5wdXQoKSBzaG93VG9vbHRpcHM6IGJvb2xlYW4gPSB0cnVlO1xuICAgLyoqIEBPdXRwdXQge2FueX0gW3ZhbHVlQ2hhbmdlPV0gRXZlbnQgZW1pdHRlZCB3aGVuIHZhbHVlIGlzIGNoYW5nZWQuIFRoaXMgZW1pdHMgdGhlIGN1cnJlbnQgZm9ybSB2YWx1ZSAqL1xuICAgQE91dHB1dCgpIHZhbHVlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICBAVmlld0NoaWxkKCdmb3JtJywgeyBzdGF0aWM6IGZhbHNlIH0pIGZvcm06IE5nRm9ybTtcblxuICAgcHVibGljIHNob3dDb2xsYXBzZWRTZWN0aW9uRmllbGRzOiBib29sZWFuID0gZmFsc2U7XG4gICBwdWJsaWMgaW5uZXJWYWx1ZTogYW55ID0ge307XG4gICBwcml2YXRlIF92YWx1ZTogYW55ID0ge307XG4gICBwcml2YXRlIF9wYXJlbnRGaWVsZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uW10gPSBbXTtcbiAgIHByaXZhdGUgX3BhcmVudEZpZWxkczogc3RyaW5nW107XG4gICBwcml2YXRlIF9zY2hlbWE6IEpTT05TY2hlbWE0O1xuXG4gICAvKiogQElucHV0IHtKU09OU2NoZW1hNCBbc2NoZW1hPV0gSlNPTiBzY2hlbWEgbmVlZGVkIHRvIGdlbmVyYXRlIHRoZSBmb3JtICovXG4gICBASW5wdXQoKSBnZXQgc2NoZW1hKCk6IEpTT05TY2hlbWE0IHtcbiAgICAgIHJldHVybiB0aGlzLl9zY2hlbWE7XG4gICB9XG5cbiAgIHNldCBzY2hlbWEoc2NoZW1hOiBKU09OU2NoZW1hNCkge1xuICAgICAgdGhpcy5fc2NoZW1hID0gc2NoZW1hO1xuICAgICAgdGhpcy5fdmFsdWUgPSB7fTtcbiAgICAgIGlmICh0aGlzLl9zY2hlbWEuZGVwZW5kZW5jaWVzKSB7XG4gICAgICAgICB0aGlzLl9wYXJlbnRGaWVsZHMgPSBPYmplY3Qua2V5cyh0aGlzLl9zY2hlbWEuZGVwZW5kZW5jaWVzKTtcbiAgICAgIH1cbiAgIH1cblxuICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgICAgaWYgKCF0aGlzLmZvcmNlVmFsaWRhdGlvbnMpIHtcbiAgICAgICAgIHRoaXMuZm9ybS5mb3JtLm1hcmtBc1ByaXN0aW5lKCk7XG4gICAgICB9XG4gICB9XG5cbiAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpOiB2b2lkIHtcbiAgICAgIGlmICh0aGlzLl9wYXJlbnRGaWVsZHMgJiYgdGhpcy5mb3JtLmNvbnRyb2wgJiYgdGhpcy5mb3JtLmNvbnRyb2wuY29udHJvbHMpIHtcbiAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fcGFyZW50RmllbGRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBsZXQgcGFyZW50RmllbGQ6IHN0cmluZyA9IHRoaXMuX3BhcmVudEZpZWxkc1tpXTtcbiAgICAgICAgICAgIGlmICghdGhpcy5fcGFyZW50RmllbGRTdWJzY3JpcHRpb25baV0gJiYgdGhpcy5mb3JtLmNvbnRyb2wuY29udHJvbHNbcGFyZW50RmllbGRdKSB7XG5cbiAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudEZpZWxkU3Vic2NyaXB0aW9uW2ldID0gdGhpcy5mb3JtLmNvbnRyb2wuY29udHJvbHNbdGhpcy5fcGFyZW50RmllbGRzW2ldXS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgbGV0IGNoaWxkcmVuRmllbGRzOiBKU09OU2NoZW1hNCB8IHN0cmluZ1tdID0gdGhpcy5zY2hlbWEuZGVwZW5kZW5jaWVzW3BhcmVudEZpZWxkXTtcbiAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY2hpbGRyZW5GaWVsZHMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvcm0uY29udHJvbHNbY2hpbGRyZW5GaWVsZHNbal1dKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZVtjaGlsZHJlbkZpZWxkc1tqXV0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cblxuICAgLy8gRnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSB2YWx1ZSBjaGFuZ2VzLlxuICAgb25DaGFuZ2UoXzogYW55KTogdm9pZCB7XG4gICB9XG5cbiAgIG9uVG91Y2hlZCA9ICgpID0+IHtcbiAgIH1cblxuICAgdmFsaWRhdGUoY29udHJvbDogRm9ybUNvbnRyb2wpOiBhbnkge1xuICAgICAgbGV0IGVycm9yczogYW55ID0gbnVsbDtcbiAgICAgIGlmICh0aGlzLmZvcm0pIHtcbiAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuZm9ybS5jb250cm9scykuZm9yRWFjaCgocHJvcGVydHlOYW1lKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5mb3JtLmNvbnRyb2xzW3Byb3BlcnR5TmFtZV0gJiYgdGhpcy5mb3JtLmNvbnRyb2xzW3Byb3BlcnR5TmFtZV0uZXJyb3JzKSB7XG4gICAgICAgICAgICAgICBpZiAoIWVycm9ycykge1xuICAgICAgICAgICAgICAgICAgZXJyb3JzID0ge307XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBlcnJvcnNbcHJvcGVydHlOYW1lXSA9IHRoaXMuZm9ybS5jb250cm9sc1twcm9wZXJ0eU5hbWVdLmVycm9ycztcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH0pO1xuXG4gICAgICAgICB0aGlzLmZvcm0uY29udHJvbC5zZXRFcnJvcnMoZXJyb3JzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlcnJvcnM7XG4gICB9XG5cbiAgIGlzUmVxdWlyZWQocHJvcGVydHlOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgIHJldHVybiBwcm9wZXJ0eU5hbWUgJiYgdGhpcy5zY2hlbWEucmVxdWlyZWQgJiYgdGhpcy5zY2hlbWEucmVxdWlyZWQuaW5kZXhPZihwcm9wZXJ0eU5hbWUpICE9PSAtMTtcbiAgIH1cblxuICAgaXNDb2xsYXBzZWRTZWN0aW9uKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHRoaXMuc2NoZW1hLnR5cGUgPT09ICdvYmplY3QnICYmIHRoaXMuc2NoZW1hLnVpICYmXG4gICAgICAgICAodGhpcy5zY2hlbWEudWkuY29tcG9uZW50ID09PSBGT1JNX1VJX0NPTVBPTkVOVC5TSE9XX01PUkUgfHwgdGhpcy5zY2hlbWEudWkuY29tcG9uZW50ID09PSBGT1JNX1VJX0NPTVBPTkVOVC5BQ0NPUkRJT04pO1xuICAgfVxuXG4gICBpU2hvd01vcmVTZWN0aW9uKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHRoaXMuc2NoZW1hLnR5cGUgPT09ICdvYmplY3QnICYmIHRoaXMuc2NoZW1hLnVpICYmIHRoaXMuc2NoZW1hLnVpLmNvbXBvbmVudCA9PT0gRk9STV9VSV9DT01QT05FTlQuU0hPV19NT1JFO1xuICAgfVxuXG4gICBpc0FQYXJlbnRGaWVsZChwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHRoaXMuc2NoZW1hLmRlcGVuZGVuY2llcyAmJiB0aGlzLnNjaGVtYS5kZXBlbmRlbmNpZXNbcHJvcGVydHlOYW1lXSAmJiB0aGlzLnNjaGVtYS5kZXBlbmRlbmNpZXNbcHJvcGVydHlOYW1lXS5sZW5ndGggPiAwO1xuICAgfVxuXG4gICBnZXRPcHRpb25hbEJ1dHRvbkxhYmVsKCk6IHN0cmluZyB7XG4gICAgICBsZXQgbGFiZWw6IHN0cmluZyA9ICdBZGRpdGlvbmFsIG9wdGlvbnMnO1xuXG4gICAgICBpZiAodGhpcy5wYXJlbnROYW1lIHx8IHRoaXMuc2NoZW1hLnRpdGxlKSB7XG4gICAgICAgICBsYWJlbCArPSAnIG9mICc7XG4gICAgICAgICBsYWJlbCArPSB0aGlzLnBhcmVudE5hbWUgfHwgdGhpcy5zY2hlbWEudGl0bGU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBsYWJlbDtcbiAgIH1cblxuICAgb25DaGFuZ2VPcHRpb25hbEZpZWxkc1Zpc2liaWxpdHkoKTogdm9pZCB7XG4gICAgICB0aGlzLnNob3dDb2xsYXBzZWRTZWN0aW9uRmllbGRzID0gIXRoaXMuc2hvd0NvbGxhcHNlZFNlY3Rpb25GaWVsZHM7XG4gICB9XG5cbiAgIGdldEZpZWxkQ2xhc3Nlcyhwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IGFueSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAgJ2hpZGRlbic6IHRoaXMuaXNDb2xsYXBzZWRTZWN0aW9uKCkgJiYgIXRoaXMuc2hvd0NvbGxhcHNlZFNlY3Rpb25GaWVsZHMsXG4gICAgICAgICAncGFyZW50LWZpZWxkJzogdGhpcy5pc0FQYXJlbnRGaWVsZChwcm9wZXJ0eU5hbWUpIHx8ICh0aGlzLmlzQVN3aXRjaFNlY3Rpb24oKSAmJiB0aGlzLmlzVGhlRmlyc3RGaWVsZChwcm9wZXJ0eU5hbWUpKVxuICAgICAgfTtcbiAgIH1cblxuICAgZmllbGRIYXNUb0JlQ3JlYXRlZChwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgbGV0IGNyZWF0ZUZpZWxkOiBib29sZWFuID0gdHJ1ZTtcbiAgICAgIGxldCBwYXJlbnRGaWVsZDogc3RyaW5nID0gdGhpcy5nZXRQYXJlbnRGaWVsZChwcm9wZXJ0eU5hbWUpO1xuICAgICAgaWYgKCgocGFyZW50RmllbGQgJiYgIXRoaXMuX3ZhbHVlW3BhcmVudEZpZWxkXSkgfHwgKHRoaXMuaXNJbkFEaXNhYmxlZFNlY3Rpb24oKSAmJiAhdGhpcy5pc1RoZUZpcnN0RmllbGQocHJvcGVydHlOYW1lKSkpXG4gICAgICAgICB8fCAhdGhpcy5mdWxmaWxsRGVwZW5kZW5jeVZpc2liaWxpdHkocHJvcGVydHlOYW1lKSkge1xuICAgICAgICAgY3JlYXRlRmllbGQgPSBmYWxzZTtcbiAgICAgICAgIHRoaXMuX3ZhbHVlW3Byb3BlcnR5TmFtZV0gPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gY3JlYXRlRmllbGQ7XG4gICB9XG5cbiAgIGlzUmVsYXRlZEZpZWxkKHByb3BlcnR5TmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICByZXR1cm4gdGhpcy5zY2hlbWEucHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLnVpICYmIHRoaXMuc2NoZW1hLnByb3BlcnRpZXNbcHJvcGVydHlOYW1lXS51aS5yZWxhdGVkVG87XG4gICB9XG5cbiAgIC8vIFdoZW4gdmFsdWUgaXMgcmVjZWl2ZWQgZnJvbSBvdXRzaWRlXG4gICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgdGhpcy5vbkNoYW5nZSh2YWx1ZSk7XG4gICAgICAgICB0aGlzLmlubmVyVmFsdWUgPSB2YWx1ZTtcbiAgICAgIH1cbiAgIH1cblxuICAgb25DaGFuZ2VQcm9wZXJ0eSh2YWx1ZTogYW55LCBwcm9wZXJ0eTogc3RyaW5nKTogdm9pZCB7XG4gICAgICB0aGlzLl92YWx1ZVtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh0aGlzLl92YWx1ZSk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgIHRoaXMub25DaGFuZ2UodGhpcy5fdmFsdWUpO1xuICAgICAgfSk7XG4gICB9XG5cbiAgIC8vIFJlZ2lzdHJ5IHRoZSBjaGFuZ2UgZnVuY3Rpb24gdG8gcHJvcGFnYXRlIGludGVybmFsIG1vZGVsIGNoYW5nZXNcbiAgIHJlZ2lzdGVyT25DaGFuZ2UoZm46IChfOiBhbnkpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgIHRoaXMub25DaGFuZ2UgPSBmbjtcbiAgIH1cblxuICAgLy8gUmVnaXN0cnkgdGhlIHRvdWNoIGZ1bmN0aW9uIHRvIHByb3BhZ2F0ZSBpbnRlcm5hbCB0b3VjaCBldmVudHMgVE9ETzogbWFrZSB0aGlzIGZ1bmN0aW9uLlxuICAgcmVnaXN0ZXJPblRvdWNoZWQoZm46ICgpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgIHRoaXMub25Ub3VjaGVkID0gZm47XG4gICB9XG5cbiAgIC8vIEFsbG93cyBBbmd1bGFyIHRvIGRpc2FibGUgdGhlIGZvcm0uXG4gICBzZXREaXNhYmxlZFN0YXRlKGRpc2FibGU6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgIGlmIChkaXNhYmxlKSB7XG4gICAgICAgICB0aGlzLmZvcm0uY29udHJvbC5kaXNhYmxlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAgdGhpcy5mb3JtLmNvbnRyb2wuZW5hYmxlKCk7XG4gICAgICB9XG4gICB9XG5cbiAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgaWYgKHRoaXMuX3BhcmVudEZpZWxkU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3BhcmVudEZpZWxkU3Vic2NyaXB0aW9uLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB0aGlzLl9wYXJlbnRGaWVsZFN1YnNjcmlwdGlvbltpXS51bnN1YnNjcmliZSgpO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgfVxuXG4gICBpc0luQURpc2FibGVkU2VjdGlvbigpOiBib29sZWFuIHtcbiAgICAgIGlmICh0aGlzLmlzQVN3aXRjaFNlY3Rpb24oKSkge1xuICAgICAgICAgbGV0IHNlY3Rpb25FbmFibGVyOiBzdHJpbmcgPSBPYmplY3Qua2V5cyh0aGlzLnNjaGVtYS5wcm9wZXJ0aWVzKVswXTtcbiAgICAgICAgIHJldHVybiAhKHRoaXMuZm9ybSAmJiB0aGlzLmZvcm0uY29udHJvbHNbc2VjdGlvbkVuYWJsZXJdICYmIHRoaXMuZm9ybS5jb250cm9sc1tzZWN0aW9uRW5hYmxlcl0udmFsdWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgfVxuXG4gICBpc0FTd2l0Y2hTZWN0aW9uKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHRoaXMuc2NoZW1hLnVpICYmIHRoaXMuc2NoZW1hLnVpLmNvbXBvbmVudCA9PT0gRk9STV9VSV9DT01QT05FTlQuU1dJVENIO1xuICAgfVxuXG4gICBpc0FuQWNjb3JkaW9uKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHRoaXMuc2NoZW1hLnVpICYmIHRoaXMuc2NoZW1hLnVpLmNvbXBvbmVudCA9PT0gRk9STV9VSV9DT01QT05FTlQuQUNDT1JESU9OO1xuICAgfVxuXG4gICBvbkNsaWNrVGl0bGUoKTogdm9pZCB7XG4gICAgICBpZiAodGhpcy5pc0FuQWNjb3JkaW9uKCkpIHtcbiAgICAgICAgIHRoaXMub25DaGFuZ2VPcHRpb25hbEZpZWxkc1Zpc2liaWxpdHkoKTtcbiAgICAgIH1cbiAgIH1cblxuICAgaXNUaGVGaXJzdEZpZWxkKHByb3BlcnR5TmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICByZXR1cm4gcHJvcGVydHlOYW1lID09PSBPYmplY3Qua2V5cyh0aGlzLnNjaGVtYS5wcm9wZXJ0aWVzKVswXTtcbiAgIH1cblxuICAgcHJpdmF0ZSBnZXRQYXJlbnRGaWVsZChwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICBsZXQgcGFyZW50RmllbGQ6IHN0cmluZyA9IHVuZGVmaW5lZDtcbiAgICAgIGlmICh0aGlzLnNjaGVtYS5kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuc2NoZW1hLmRlcGVuZGVuY2llcykuZm9yRWFjaCgoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNjaGVtYS5kZXBlbmRlbmNpZXNba2V5XS5pbmRleE9mKHByb3BlcnR5TmFtZSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICBwYXJlbnRGaWVsZCA9IGtleTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHBhcmVudEZpZWxkO1xuICAgfVxuXG4gICBwcml2YXRlIGZ1bGZpbGxEZXBlbmRlbmN5VmlzaWJpbGl0eShwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgbGV0IGZ1bGZpbGw6IGJvb2xlYW4gPSB0cnVlO1xuICAgICAgbGV0IHByb3BlcnR5U2NoZW1hOiBhbnkgPSB0aGlzLnNjaGVtYS5wcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XG4gICAgICBpZiAocHJvcGVydHlTY2hlbWEudWkgJiYgcHJvcGVydHlTY2hlbWEudWkudmlzaWJsZSkge1xuICAgICAgICAgY29uc3Qga2V5czogc3RyaW5nW10gPSBPYmplY3Qua2V5cyhwcm9wZXJ0eVNjaGVtYS51aS52aXNpYmxlKTtcbiAgICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgIHdoaWxlIChmdWxmaWxsICYmIGkgPCBrZXlzLmxlbmd0aCAmJiBwcm9wZXJ0eVNjaGVtYS51aS52aXNpYmxlLmhhc093blByb3BlcnR5KGtleXNbaV0pKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdmFsdWVba2V5c1tpXV0gIT09IHByb3BlcnR5U2NoZW1hLnVpLnZpc2libGVba2V5c1tpXV0pIHtcbiAgICAgICAgICAgICAgIGZ1bGZpbGwgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICsraTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmdWxmaWxsO1xuICAgfVxufVxuIl19