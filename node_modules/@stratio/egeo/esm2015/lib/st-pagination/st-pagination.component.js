/**
 * @fileoverview added by tsickle
 * Generated from: lib/st-pagination/st-pagination.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * © 2017 Stratio Big Data Inc., Sucursal en España.
 *
 * This software is licensed under the Apache License, Version 2.0.
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the terms of the License for more details.
 *
 * SPDX-License-Identifier: Apache-2.0.
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, Output, ElementRef } from '@angular/core';
/**
 * \@description {Component} [Table]
 *
 * The pagination component has been designed to allow content to be displayed per pages. This informs user about the
 * number of the current page, the items displayed per page and the total of items. Moreover, when there are a lot of
 * items, it allows user to customize the number of items displayed per page.
 *
 * It is made by two sub-components:
 * - A range selector, that allows the user provides a dropdown to set how many items he wants to be displayed per page.
 * - A page navigation control, in order to let the user where he is and where he can go to.
 *
 * * \@model
 *
 *   [Paginate] {./st-pagination.interface.ts#Paginate}
 *   [PaginateOptions] {./st-pagination.interface.ts#PaginateOptions}
 *   [PaginateTexts] {./st-pagination.interface.ts#PaginateTexts}
 *   [PaginateTextsSchema] {./st-pagination.interface.ts#PaginateTextsSchema}
 *   [PaginateIconClasses] {./st-pagination.interface.ts#PaginateIconClasses}
 *
 * \@example
 *
 * {html}
 *
 * ```
 * <div class="pagination">
 *     <st-pagination [total]="items.length" [perPage]="perPage" [currentPage]="page" [id]="'pagination-demo'"
 *     (change)="onChangePage($event)">
 *     </st-pagination>
 *     </div>
 * ```
 *
 */
export class StPaginationComponent {
    /**
     * @param {?} _cd
     * @param {?} _paginationElement
     */
    constructor(_cd, _paginationElement) {
        this._cd = _cd;
        this._paginationElement = _paginationElement;
        /**
         * \@Input {number} [perPage=20] The maximum number of items displayed per page
         */
        this.perPage = 20;
        /**
         * \@Input {PaginateTexts} [label={element: 'Rows', perPage: 'per page', of: 'of'}] Translated texts displayed at the pagination
         */
        this.label = {
            element: 'Rows', perPage: 'per page', of: 'of'
        };
        /**
         * \@Input {PaginateOptions[]}
         * [perPageOptions=Array( Object( value: 20, showFrom: 0 ),Object( value: 50, showFrom: 50 ), Object( value: 200, showFrom: 200 ))]
         *  List of options displayed at a selector where user can change the number of items displayed per page
         */
        this.perPageOptions = [
            { value: 20, showFrom: 0 }, { value: 50, showFrom: 50 }, { value: 200, showFrom: 200 }
        ];
        /**
         * \@Input {PaginateIconClasses} [iconClasses=Object(previous='', next='')] Icon classes for previous and next page buttons
         */
        this.iconClasses = { previous: 'icon-arrow2_left', next: 'icon-arrow2_right' };
        /**
         * \@Output {Paginate} [change=''] Event emitted when user interacts with some of the elements in the pagination.
         *  This sends the new pagination status (current page and items per page)
         */
        this.change = new EventEmitter();
        /**
         * \@Output {PaginateOptions} [changePerPage='']  Event emitted when user interacts with some of the elements in the selector of items displayed per page.
         * This sends the current items per page.
         */
        this.changePerPage = new EventEmitter();
        this.disableNextButton = false;
        this.disablePrevButton = true;
        this.items = [];
        this._currentPage = 1;
    }
    /**
     * \@Input {number} [currentPage=1] Number of the current page
     * @return {?}
     */
    get currentPage() {
        return this._currentPage;
    }
    /**
     * @param {?} currentPage
     * @return {?}
     */
    set currentPage(currentPage) {
        this._currentPage = currentPage;
    }
    /**
     * @return {?}
     */
    get hasOptions() {
        return this.items && this.items.length > 1;
    }
    /**
     * @return {?}
     */
    get paginationId() {
        /** @type {?} */
        const pagination = this._paginationElement.nativeElement;
        return pagination.getAttribute('id') !== null ? pagination.id : null;
    }
    /**
     * @return {?}
     */
    get selectId() {
        return this.paginationId !== null ? `${this.paginationId}-select` : null;
    }
    /**
     * @return {?}
     */
    get buttonPrevId() {
        return this.paginationId !== null ? `${this.paginationId}-prev` : null;
    }
    /**
     * @return {?}
     */
    get buttonNextId() {
        return this.paginationId !== null ? `${this.paginationId}-next` : null;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.updatePages(false);
        this.generateItems();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.total && changes.total.previousValue !== changes.total.currentValue && !changes.total.firstChange) {
            this.generateItems();
            this.updatePages(false);
        }
        if (changes.currentPage && changes.currentPage.previousValue !== changes.currentPage.currentValue && !changes.currentPage.firstChange) {
            this._currentPage = changes.currentPage.currentValue;
            this.updatePages(false);
        }
        if (changes.perPage && changes.perPage.previousValue !== changes.perPage.currentValue && !changes.perPage.firstChange) {
            this.onChangePerPage(changes.perPage.currentValue);
        }
    }
    /**
     * @return {?}
     */
    generateItems() {
        this.items = [];
        this.perPageOptions.forEach(this.addPageOption.bind(this));
        if (this.items.length) {
            this.selectedItem = this.items.find((/**
             * @param {?} item
             * @return {?}
             */
            item => item.value === this.perPage)) || this.items[0];
        }
        this._cd.markForCheck();
    }
    /**
     * @return {?}
     */
    nextPage() {
        this.currentPage++;
        this.updatePages();
    }
    /**
     * @return {?}
     */
    prevPage() {
        this.currentPage--;
        this.updatePages();
    }
    /**
     * @param {?} perPage
     * @return {?}
     */
    onChangePerPage(perPage) {
        if (perPage && typeof perPage === 'number') {
            this.currentPage = 1;
            this.perPage = perPage;
            this.updatePages();
            this.selectedItem = this.items.find((/**
             * @param {?} item
             * @return {?}
             */
            item => item.value === this.perPage));
            this.changePerPage.emit(this.perPage);
        }
    }
    /**
     * @private
     * @param {?} option
     * @return {?}
     */
    addPageOption(option) {
        if (this.total && (!option.showFrom || option.showFrom <= this.total)) {
            this.items.push({
                label: `${option.value}`,
                value: option.value
            });
        }
    }
    /**
     * @private
     * @param {?=} emit
     * @return {?}
     */
    updatePages(emit = true) {
        this.lastItem = this.perPage * this._currentPage;
        if (this.currentPage === 1) {
            this.firstItem = this._currentPage;
            this.disablePrevButton = true;
        }
        else {
            this.firstItem = this.perPage * (this._currentPage - 1) + 1;
            this.disablePrevButton = false;
        }
        if (this.lastItem >= this.total) {
            this.lastItem = this.total;
            this.disableNextButton = true;
        }
        else {
            this.disableNextButton = false;
        }
        if (emit) {
            this.change.emit({
                currentPage: this._currentPage,
                perPage: this.perPage
            });
        }
    }
}
StPaginationComponent.decorators = [
    { type: Component, args: [{
                selector: 'st-pagination',
                template: "<!--\n\n    \u00A9 2017 Stratio Big Data Inc., Sucursal en Espa\u00F1a.\n\n    This software is licensed under the Apache License, Version 2.0.\n    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n    See the terms of the License for more details.\n\n    SPDX-License-Identifier: Apache-2.0.\n\n-->\n<div class=\"st-pagination pagination\">\n   <div *ngIf=\"hasOptions\" class=\"label st-pagination__per-page\">\n      <p class=\"st-pagination__label\">{{label.element}} {{label.perPage}}</p>\n      <st-select class=\"st-pagination__selector\" [options]=\"items\" [selected]=\"selectedItem\" (select)=\"onChangePerPage($event)\" [attr.id]=\"selectId\"></st-select>\n   </div>\n\n   <div class=\"label current-page-info\">\n      <p class=\"st-pagination__label\">{{firstItem}}-{{lastItem}} {{label.of || 'of'}} {{total}}</p>\n\n      <div class=\"buttons\">\n         <button class=\"button button-toolbar\" [attr.id]=\"buttonPrevId\" [disabled]=\"disablePrevButton\" type=\"button\" (click)=\"prevPage()\">\n            <i class=\"{{iconClasses?.previous || 'icon-arrow2_left'}}\"></i>\n         </button>\n         <button class=\"button button-toolbar\" [attr.id]=\"buttonNextId\" [disabled]=\"disableNextButton\" type=\"button\" (click)=\"nextPage()\">\n            <i class=\"{{iconClasses?.next || 'icon-arrow2_right'}}\"></i>\n         </button>\n      </div>\n   </div>\n</div>\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: ["@charset \"UTF-8\";.pagination{display:flex;align-items:center;height:42px}.pagination .label{display:flex;align-items:center}.pagination .label p{margin:0;padding-right:15px}.pagination .current-page-info{flex:1;justify-content:flex-end}.pagination .st-pagination__selector{max-width:93px}.pagination button:first-child{margin:0 5px}"]
            }] }
];
/** @nocollapse */
StPaginationComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: ElementRef }
];
StPaginationComponent.propDecorators = {
    perPage: [{ type: Input }],
    total: [{ type: Input }],
    label: [{ type: Input }],
    perPageOptions: [{ type: Input }],
    iconClasses: [{ type: Input }],
    change: [{ type: Output }],
    changePerPage: [{ type: Output }],
    currentPage: [{ type: Input }]
};
if (false) {
    /**
     * \@Input {number} [perPage=20] The maximum number of items displayed per page
     * @type {?}
     */
    StPaginationComponent.prototype.perPage;
    /**
     * \@Input {number} [total=''] Total of items
     * @type {?}
     */
    StPaginationComponent.prototype.total;
    /**
     * \@Input {PaginateTexts} [label={element: 'Rows', perPage: 'per page', of: 'of'}] Translated texts displayed at the pagination
     * @type {?}
     */
    StPaginationComponent.prototype.label;
    /**
     * \@Input {PaginateOptions[]}
     * [perPageOptions=Array( Object( value: 20, showFrom: 0 ),Object( value: 50, showFrom: 50 ), Object( value: 200, showFrom: 200 ))]
     *  List of options displayed at a selector where user can change the number of items displayed per page
     * @type {?}
     */
    StPaginationComponent.prototype.perPageOptions;
    /**
     * \@Input {PaginateIconClasses} [iconClasses=Object(previous='', next='')] Icon classes for previous and next page buttons
     * @type {?}
     */
    StPaginationComponent.prototype.iconClasses;
    /**
     * \@Output {Paginate} [change=''] Event emitted when user interacts with some of the elements in the pagination.
     *  This sends the new pagination status (current page and items per page)
     * @type {?}
     */
    StPaginationComponent.prototype.change;
    /**
     * \@Output {PaginateOptions} [changePerPage='']  Event emitted when user interacts with some of the elements in the selector of items displayed per page.
     * This sends the current items per page.
     * @type {?}
     */
    StPaginationComponent.prototype.changePerPage;
    /** @type {?} */
    StPaginationComponent.prototype.disableNextButton;
    /** @type {?} */
    StPaginationComponent.prototype.disablePrevButton;
    /** @type {?} */
    StPaginationComponent.prototype.firstItem;
    /** @type {?} */
    StPaginationComponent.prototype.lastItem;
    /** @type {?} */
    StPaginationComponent.prototype.items;
    /** @type {?} */
    StPaginationComponent.prototype.selectedItem;
    /**
     * @type {?}
     * @private
     */
    StPaginationComponent.prototype._currentPage;
    /**
     * @type {?}
     * @private
     */
    StPaginationComponent.prototype._cd;
    /**
     * @type {?}
     * @private
     */
    StPaginationComponent.prototype._paginationElement;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3QtcGFnaW5hdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac3RyYXRpby9lZ2VvLyIsInNvdXJjZXMiOlsibGliL3N0LXBhZ2luYXRpb24vc3QtcGFnaW5hdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBVUEsT0FBTyxFQUNKLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUVOLFVBQVUsRUFDWixNQUFNLGVBQWUsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkN2QixNQUFNLE9BQU8scUJBQXFCOzs7OztJQW9EL0IsWUFBb0IsR0FBc0IsRUFDdEIsa0JBQThCO1FBRDlCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ3RCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBWTs7OztRQW5EekMsWUFBTyxHQUFXLEVBQUUsQ0FBQzs7OztRQU1yQixVQUFLLEdBQWtCO1lBQzdCLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxFQUFFLEVBQUUsSUFBSTtTQUNoRCxDQUFDOzs7Ozs7UUFNTyxtQkFBYyxHQUFzQjtZQUMxQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUU7U0FDeEYsQ0FBQzs7OztRQUdPLGdCQUFXLEdBQXdCLEVBQUMsUUFBUSxFQUFFLGtCQUFrQixFQUFFLElBQUksRUFBRSxtQkFBbUIsRUFBQyxDQUFDOzs7OztRQUs1RixXQUFNLEdBQTJCLElBQUksWUFBWSxFQUFZLENBQUM7Ozs7O1FBSzlELGtCQUFhLEdBQXlCLElBQUksWUFBWSxFQUFVLENBQUM7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SCxTQUFTLFNBQUM7Z0JBQ1IsUUFBUSxFQUFFLGVBQWU7Z0JBQ3pCLGtnREFBNkM7Z0JBRTdDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOzthQUNqRDs7OztZQW5ERSxpQkFBaUI7WUFRakIsVUFBVTs7O3NCQThDVCxLQUFLO29CQUdMLEtBQUs7b0JBR0wsS0FBSzs2QkFRTCxLQUFLOzBCQUtMLEtBQUs7cUJBS0wsTUFBTTs0QkFLTixNQUFNOzBCQUdOLEtBQUs7Ozs7Ozs7SUFoQ04sd0NBQThCOzs7OztJQUc5QixzQ0FBdUI7Ozs7O0lBR3ZCLHNDQUVFOzs7Ozs7O0lBTUYsK0NBRUU7Ozs7O0lBR0YsNENBQXNHOzs7Ozs7SUFLdEcsdUNBQXdFOzs7Ozs7SUFLeEUsOENBQTJFOztJQVkzRSxrREFBMEM7O0lBQzFDLGtEQUF5Qzs7SUFDekMsMENBQXlCOztJQUN6Qix5Q0FBd0I7O0lBQ3hCLHNDQUF3Qzs7SUFDeEMsNkNBQXdDOzs7OztJQUV4Qyw2Q0FBaUM7Ozs7O0lBRXJCLG9DQUE4Qjs7Ozs7SUFDOUIsbURBQXNDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIMKpIDIwMTcgU3RyYXRpbyBCaWcgRGF0YSBJbmMuLCBTdWN1cnNhbCBlbiBFc3Bhw7FhLlxuICpcbiAqIFRoaXMgc29mdHdhcmUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC5cbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7XG4gKiB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLlxuICogU2VlIHRoZSB0ZXJtcyBvZiB0aGUgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wLlxuICovXG5pbXBvcnQge1xuICAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgIENvbXBvbmVudCxcbiAgIEV2ZW50RW1pdHRlcixcbiAgIElucHV0LFxuICAgT25DaGFuZ2VzLFxuICAgT25Jbml0LFxuICAgT3V0cHV0LFxuICAgU2ltcGxlQ2hhbmdlcyxcbiAgIEVsZW1lbnRSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdERyb3BEb3duTWVudUl0ZW0gfSBmcm9tICcuLi9zdC1kcm9wZG93bi1tZW51L3N0LWRyb3Bkb3duLW1lbnUuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBhZ2luYXRlLCBQYWdpbmF0ZU9wdGlvbnMsIFBhZ2luYXRlVGV4dHMgfSBmcm9tICcuL3N0LXBhZ2luYXRpb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IFBhZ2luYXRlSWNvbkNsYXNzZXMgfSBmcm9tICcuL3N0LXBhZ2luYXRpb24uaW50ZXJmYWNlJztcblxuLyoqXG4gKiBAZGVzY3JpcHRpb24ge0NvbXBvbmVudH0gW1RhYmxlXVxuICpcbiAqIFRoZSBwYWdpbmF0aW9uIGNvbXBvbmVudCBoYXMgYmVlbiBkZXNpZ25lZCB0byBhbGxvdyBjb250ZW50IHRvIGJlIGRpc3BsYXllZCBwZXIgcGFnZXMuIFRoaXMgaW5mb3JtcyB1c2VyIGFib3V0IHRoZVxuICogbnVtYmVyIG9mIHRoZSBjdXJyZW50IHBhZ2UsIHRoZSBpdGVtcyBkaXNwbGF5ZWQgcGVyIHBhZ2UgYW5kIHRoZSB0b3RhbCBvZiBpdGVtcy4gTW9yZW92ZXIsIHdoZW4gdGhlcmUgYXJlIGEgbG90IG9mXG4gKiBpdGVtcywgaXQgYWxsb3dzIHVzZXIgdG8gY3VzdG9taXplIHRoZSBudW1iZXIgb2YgaXRlbXMgZGlzcGxheWVkIHBlciBwYWdlLlxuICpcbiAqIEl0IGlzIG1hZGUgYnkgdHdvIHN1Yi1jb21wb25lbnRzOlxuICogLSBBIHJhbmdlIHNlbGVjdG9yLCB0aGF0IGFsbG93cyB0aGUgdXNlciBwcm92aWRlcyBhIGRyb3Bkb3duIHRvIHNldCBob3cgbWFueSBpdGVtcyBoZSB3YW50cyB0byBiZSBkaXNwbGF5ZWQgcGVyIHBhZ2UuXG4gKiAtIEEgcGFnZSBuYXZpZ2F0aW9uIGNvbnRyb2wsIGluIG9yZGVyIHRvIGxldCB0aGUgdXNlciB3aGVyZSBoZSBpcyBhbmQgd2hlcmUgaGUgY2FuIGdvIHRvLlxuICpcbiAqICogQG1vZGVsXG4gKlxuICogICBbUGFnaW5hdGVdIHsuL3N0LXBhZ2luYXRpb24uaW50ZXJmYWNlLnRzI1BhZ2luYXRlfVxuICogICBbUGFnaW5hdGVPcHRpb25zXSB7Li9zdC1wYWdpbmF0aW9uLmludGVyZmFjZS50cyNQYWdpbmF0ZU9wdGlvbnN9XG4gKiAgIFtQYWdpbmF0ZVRleHRzXSB7Li9zdC1wYWdpbmF0aW9uLmludGVyZmFjZS50cyNQYWdpbmF0ZVRleHRzfVxuICogICBbUGFnaW5hdGVUZXh0c1NjaGVtYV0gey4vc3QtcGFnaW5hdGlvbi5pbnRlcmZhY2UudHMjUGFnaW5hdGVUZXh0c1NjaGVtYX1cbiAqICAgW1BhZ2luYXRlSWNvbkNsYXNzZXNdIHsuL3N0LXBhZ2luYXRpb24uaW50ZXJmYWNlLnRzI1BhZ2luYXRlSWNvbkNsYXNzZXN9XG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiB7aHRtbH1cbiAqXG4gKiBgYGBcbiAqIDxkaXYgY2xhc3M9XCJwYWdpbmF0aW9uXCI+XG4gKiAgICAgPHN0LXBhZ2luYXRpb24gW3RvdGFsXT1cIml0ZW1zLmxlbmd0aFwiIFtwZXJQYWdlXT1cInBlclBhZ2VcIiBbY3VycmVudFBhZ2VdPVwicGFnZVwiIFtpZF09XCIncGFnaW5hdGlvbi1kZW1vJ1wiXG4gKiAgICAgKGNoYW5nZSk9XCJvbkNoYW5nZVBhZ2UoJGV2ZW50KVwiPlxuICogICAgIDwvc3QtcGFnaW5hdGlvbj5cbiAqICAgICA8L2Rpdj5cbiAqIGBgYFxuICpcbiAqL1xuQENvbXBvbmVudCh7XG4gICBzZWxlY3RvcjogJ3N0LXBhZ2luYXRpb24nLFxuICAgdGVtcGxhdGVVcmw6ICcuL3N0LXBhZ2luYXRpb24uY29tcG9uZW50Lmh0bWwnLFxuICAgc3R5bGVVcmxzOiBbJy4vc3QtcGFnaW5hdGlvbi5jb21wb25lbnQuc2NzcyddLFxuICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgU3RQYWdpbmF0aW9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICAgLyoqIEBJbnB1dCB7bnVtYmVyfSBbcGVyUGFnZT0yMF0gVGhlIG1heGltdW0gbnVtYmVyIG9mIGl0ZW1zIGRpc3BsYXllZCBwZXIgcGFnZSAqL1xuICAgQElucHV0KCkgcGVyUGFnZTogbnVtYmVyID0gMjA7XG5cbiAgIC8qKiBASW5wdXQge251bWJlcn0gW3RvdGFsPScnXSBUb3RhbCBvZiBpdGVtcyAqL1xuICAgQElucHV0KCkgdG90YWw6IG51bWJlcjtcblxuICAgLyoqIEBJbnB1dCB7UGFnaW5hdGVUZXh0c30gW2xhYmVsPXtlbGVtZW50OiAnUm93cycsIHBlclBhZ2U6ICdwZXIgcGFnZScsIG9mOiAnb2YnfV0gVHJhbnNsYXRlZCB0ZXh0cyBkaXNwbGF5ZWQgYXQgdGhlIHBhZ2luYXRpb24gKi9cbiAgIEBJbnB1dCgpIGxhYmVsOiBQYWdpbmF0ZVRleHRzID0ge1xuICAgICAgZWxlbWVudDogJ1Jvd3MnLCBwZXJQYWdlOiAncGVyIHBhZ2UnLCBvZjogJ29mJ1xuICAgfTtcblxuICAgLyoqIEBJbnB1dCB7UGFnaW5hdGVPcHRpb25zW119XG4gICAgKiBbcGVyUGFnZU9wdGlvbnM9QXJyYXkoIE9iamVjdCggdmFsdWU6IDIwLCBzaG93RnJvbTogMCApLE9iamVjdCggdmFsdWU6IDUwLCBzaG93RnJvbTogNTAgKSwgT2JqZWN0KCB2YWx1ZTogMjAwLCBzaG93RnJvbTogMjAwICkpXVxuICAgICogIExpc3Qgb2Ygb3B0aW9ucyBkaXNwbGF5ZWQgYXQgYSBzZWxlY3RvciB3aGVyZSB1c2VyIGNhbiBjaGFuZ2UgdGhlIG51bWJlciBvZiBpdGVtcyBkaXNwbGF5ZWQgcGVyIHBhZ2VcbiAgICAqL1xuICAgQElucHV0KCkgcGVyUGFnZU9wdGlvbnM6IFBhZ2luYXRlT3B0aW9uc1tdID0gW1xuICAgICAgeyB2YWx1ZTogMjAsIHNob3dGcm9tOiAwIH0sIHsgdmFsdWU6IDUwLCBzaG93RnJvbTogNTAgfSwgeyB2YWx1ZTogMjAwLCBzaG93RnJvbTogMjAwIH1cbiAgIF07XG5cbiAgIC8qKiBASW5wdXQge1BhZ2luYXRlSWNvbkNsYXNzZXN9IFtpY29uQ2xhc3Nlcz1PYmplY3QocHJldmlvdXM9JycsIG5leHQ9JycpXSBJY29uIGNsYXNzZXMgZm9yIHByZXZpb3VzIGFuZCBuZXh0IHBhZ2UgYnV0dG9ucyAqL1xuICAgQElucHV0KCkgaWNvbkNsYXNzZXM6IFBhZ2luYXRlSWNvbkNsYXNzZXMgPSB7cHJldmlvdXM6ICdpY29uLWFycm93Ml9sZWZ0JywgbmV4dDogJ2ljb24tYXJyb3cyX3JpZ2h0J307XG5cbiAgIC8qKiBAT3V0cHV0IHtQYWdpbmF0ZX0gW2NoYW5nZT0nJ10gRXZlbnQgZW1pdHRlZCB3aGVuIHVzZXIgaW50ZXJhY3RzIHdpdGggc29tZSBvZiB0aGUgZWxlbWVudHMgaW4gdGhlIHBhZ2luYXRpb24uXG4gICAgKiAgVGhpcyBzZW5kcyB0aGUgbmV3IHBhZ2luYXRpb24gc3RhdHVzIChjdXJyZW50IHBhZ2UgYW5kIGl0ZW1zIHBlciBwYWdlKVxuICAgICovXG4gICBAT3V0cHV0KCkgY2hhbmdlOiBFdmVudEVtaXR0ZXI8UGFnaW5hdGU+ID0gbmV3IEV2ZW50RW1pdHRlcjxQYWdpbmF0ZT4oKTtcblxuICAgLyoqIEBPdXRwdXQge1BhZ2luYXRlT3B0aW9uc30gW2NoYW5nZVBlclBhZ2U9JyddICBFdmVudCBlbWl0dGVkIHdoZW4gdXNlciBpbnRlcmFjdHMgd2l0aCBzb21lIG9mIHRoZSBlbGVtZW50cyBpbiB0aGUgc2VsZWN0b3Igb2YgaXRlbXMgZGlzcGxheWVkIHBlciBwYWdlLlxuICAgICogVGhpcyBzZW5kcyB0aGUgY3VycmVudCBpdGVtcyBwZXIgcGFnZS5cbiAgICAqL1xuICAgQE91dHB1dCgpIGNoYW5nZVBlclBhZ2U6IEV2ZW50RW1pdHRlcjxudW1iZXI+ID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG5cbiAgIC8qKiBASW5wdXQge251bWJlcn0gW2N1cnJlbnRQYWdlPTFdIE51bWJlciBvZiB0aGUgY3VycmVudCBwYWdlICovXG4gICBASW5wdXQoKVxuICAgZ2V0IGN1cnJlbnRQYWdlKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gdGhpcy5fY3VycmVudFBhZ2U7XG4gICB9XG5cbiAgIHNldCBjdXJyZW50UGFnZShjdXJyZW50UGFnZTogbnVtYmVyKSB7XG4gICAgICB0aGlzLl9jdXJyZW50UGFnZSA9IGN1cnJlbnRQYWdlO1xuICAgfVxuXG4gICBwdWJsaWMgZGlzYWJsZU5leHRCdXR0b246IGJvb2xlYW4gPSBmYWxzZTtcbiAgIHB1YmxpYyBkaXNhYmxlUHJldkJ1dHRvbjogYm9vbGVhbiA9IHRydWU7XG4gICBwdWJsaWMgZmlyc3RJdGVtOiBudW1iZXI7XG4gICBwdWJsaWMgbGFzdEl0ZW06IG51bWJlcjtcbiAgIHB1YmxpYyBpdGVtczogU3REcm9wRG93bk1lbnVJdGVtW10gPSBbXTtcbiAgIHB1YmxpYyBzZWxlY3RlZEl0ZW06IFN0RHJvcERvd25NZW51SXRlbTtcblxuICAgcHJpdmF0ZSBfY3VycmVudFBhZ2U6IG51bWJlciA9IDE7XG5cbiAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX2NkOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgICAgICAgIHByaXZhdGUgX3BhZ2luYXRpb25FbGVtZW50OiBFbGVtZW50UmVmKSB7XG4gICB9XG5cbiAgIGdldCBoYXNPcHRpb25zKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHRoaXMuaXRlbXMgJiYgdGhpcy5pdGVtcy5sZW5ndGggPiAxO1xuICAgfVxuXG4gICBnZXQgcGFnaW5hdGlvbklkKCk6IHN0cmluZyB8IG51bGwge1xuICAgICAgY29uc3QgcGFnaW5hdGlvbjogSFRNTEVsZW1lbnQgPSB0aGlzLl9wYWdpbmF0aW9uRWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICAgICAgcmV0dXJuIHBhZ2luYXRpb24uZ2V0QXR0cmlidXRlKCdpZCcpICE9PSBudWxsID8gcGFnaW5hdGlvbi5pZCA6IG51bGw7XG4gICB9XG5cbiAgIGdldCBzZWxlY3RJZCgpOiBzdHJpbmcge1xuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbklkICE9PSBudWxsID8gYCR7dGhpcy5wYWdpbmF0aW9uSWR9LXNlbGVjdGAgOiBudWxsO1xuICAgfVxuXG4gICBnZXQgYnV0dG9uUHJldklkKCk6IHN0cmluZyB7XG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSWQgIT09IG51bGwgPyBgJHt0aGlzLnBhZ2luYXRpb25JZH0tcHJldmAgOiBudWxsO1xuICAgfVxuXG4gICBnZXQgYnV0dG9uTmV4dElkKCk6IHN0cmluZyB7XG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSWQgIT09IG51bGwgPyBgJHt0aGlzLnBhZ2luYXRpb25JZH0tbmV4dGAgOiBudWxsO1xuICAgfVxuXG4gICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAgIHRoaXMudXBkYXRlUGFnZXMoZmFsc2UpO1xuICAgICAgdGhpcy5nZW5lcmF0ZUl0ZW1zKCk7XG4gICB9XG5cbiAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICAgIGlmIChjaGFuZ2VzLnRvdGFsICYmIGNoYW5nZXMudG90YWwucHJldmlvdXNWYWx1ZSAhPT0gY2hhbmdlcy50b3RhbC5jdXJyZW50VmFsdWUgJiYgIWNoYW5nZXMudG90YWwuZmlyc3RDaGFuZ2UpIHtcbiAgICAgICAgIHRoaXMuZ2VuZXJhdGVJdGVtcygpO1xuICAgICAgICAgdGhpcy51cGRhdGVQYWdlcyhmYWxzZSk7XG4gICAgICB9XG4gICAgICBpZiAoY2hhbmdlcy5jdXJyZW50UGFnZSAmJiBjaGFuZ2VzLmN1cnJlbnRQYWdlLnByZXZpb3VzVmFsdWUgIT09IGNoYW5nZXMuY3VycmVudFBhZ2UuY3VycmVudFZhbHVlICYmICFjaGFuZ2VzLmN1cnJlbnRQYWdlLmZpcnN0Q2hhbmdlKSB7XG4gICAgICAgICB0aGlzLl9jdXJyZW50UGFnZSA9IGNoYW5nZXMuY3VycmVudFBhZ2UuY3VycmVudFZhbHVlO1xuICAgICAgICAgdGhpcy51cGRhdGVQYWdlcyhmYWxzZSk7XG4gICAgICB9XG4gICAgICBpZiAoY2hhbmdlcy5wZXJQYWdlICYmIGNoYW5nZXMucGVyUGFnZS5wcmV2aW91c1ZhbHVlICE9PSBjaGFuZ2VzLnBlclBhZ2UuY3VycmVudFZhbHVlICYmICFjaGFuZ2VzLnBlclBhZ2UuZmlyc3RDaGFuZ2UpIHtcbiAgICAgICAgIHRoaXMub25DaGFuZ2VQZXJQYWdlKGNoYW5nZXMucGVyUGFnZS5jdXJyZW50VmFsdWUpO1xuICAgICAgfVxuICAgfVxuXG4gICBnZW5lcmF0ZUl0ZW1zKCk6IHZvaWQge1xuICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgdGhpcy5wZXJQYWdlT3B0aW9ucy5mb3JFYWNoKHRoaXMuYWRkUGFnZU9wdGlvbi5iaW5kKHRoaXMpKTtcblxuICAgICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbSA9IHRoaXMuaXRlbXMuZmluZChpdGVtID0+IGl0ZW0udmFsdWUgPT09IHRoaXMucGVyUGFnZSkgfHwgdGhpcy5pdGVtc1swXTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fY2QubWFya0ZvckNoZWNrKCk7XG4gICB9XG5cbiAgIG5leHRQYWdlKCk6IHZvaWQge1xuICAgICAgdGhpcy5jdXJyZW50UGFnZSsrO1xuICAgICAgdGhpcy51cGRhdGVQYWdlcygpO1xuICAgfVxuXG4gICBwcmV2UGFnZSgpOiB2b2lkIHtcbiAgICAgIHRoaXMuY3VycmVudFBhZ2UtLTtcbiAgICAgIHRoaXMudXBkYXRlUGFnZXMoKTtcbiAgIH1cblxuICAgb25DaGFuZ2VQZXJQYWdlKHBlclBhZ2U6IG51bWJlcik6IHZvaWQge1xuICAgICAgaWYgKHBlclBhZ2UgJiYgdHlwZW9mIHBlclBhZ2UgPT09ICdudW1iZXInKSB7XG4gICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgIHRoaXMucGVyUGFnZSA9IHBlclBhZ2U7XG4gICAgICAgICB0aGlzLnVwZGF0ZVBhZ2VzKCk7XG4gICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbSA9IHRoaXMuaXRlbXMuZmluZChpdGVtID0+IGl0ZW0udmFsdWUgPT09IHRoaXMucGVyUGFnZSk7XG4gICAgICAgICB0aGlzLmNoYW5nZVBlclBhZ2UuZW1pdCh0aGlzLnBlclBhZ2UpO1xuICAgICAgfVxuICAgfVxuXG4gICBwcml2YXRlIGFkZFBhZ2VPcHRpb24ob3B0aW9uOiBQYWdpbmF0ZU9wdGlvbnMpOiB2b2lkIHtcbiAgICAgIGlmICh0aGlzLnRvdGFsICYmICghb3B0aW9uLnNob3dGcm9tIHx8IG9wdGlvbi5zaG93RnJvbSA8PSB0aGlzLnRvdGFsKSkge1xuICAgICAgICAgdGhpcy5pdGVtcy5wdXNoKHtcbiAgICAgICAgICAgIGxhYmVsOiBgJHtvcHRpb24udmFsdWV9YCxcbiAgICAgICAgICAgIHZhbHVlOiBvcHRpb24udmFsdWVcbiAgICAgICAgIH0pO1xuICAgICAgfVxuICAgfVxuXG4gICBwcml2YXRlIHVwZGF0ZVBhZ2VzKGVtaXQ6IGJvb2xlYW4gPSB0cnVlKTogdm9pZCB7XG4gICAgICB0aGlzLmxhc3RJdGVtID0gdGhpcy5wZXJQYWdlICogdGhpcy5fY3VycmVudFBhZ2U7XG5cbiAgICAgIGlmICh0aGlzLmN1cnJlbnRQYWdlID09PSAxKSB7XG4gICAgICAgICB0aGlzLmZpcnN0SXRlbSA9IHRoaXMuX2N1cnJlbnRQYWdlO1xuICAgICAgICAgdGhpcy5kaXNhYmxlUHJldkJ1dHRvbiA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAgdGhpcy5maXJzdEl0ZW0gPSB0aGlzLnBlclBhZ2UgKiAodGhpcy5fY3VycmVudFBhZ2UgLSAxKSArIDE7XG4gICAgICAgICB0aGlzLmRpc2FibGVQcmV2QnV0dG9uID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmxhc3RJdGVtID49IHRoaXMudG90YWwpIHtcbiAgICAgICAgIHRoaXMubGFzdEl0ZW0gPSB0aGlzLnRvdGFsO1xuICAgICAgICAgdGhpcy5kaXNhYmxlTmV4dEJ1dHRvbiA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAgdGhpcy5kaXNhYmxlTmV4dEJ1dHRvbiA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAoZW1pdCkge1xuICAgICAgICAgdGhpcy5jaGFuZ2UuZW1pdCh7XG4gICAgICAgICAgICBjdXJyZW50UGFnZTogdGhpcy5fY3VycmVudFBhZ2UsXG4gICAgICAgICAgICBwZXJQYWdlOiB0aGlzLnBlclBhZ2VcbiAgICAgICAgIH0pO1xuICAgICAgfVxuICAgfVxufVxuIl19