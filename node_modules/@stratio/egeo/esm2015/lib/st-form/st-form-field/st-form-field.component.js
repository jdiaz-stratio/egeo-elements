var StFormFieldComponent_1;
/**
 * @fileoverview added by tsickle
 * Generated from: lib/st-form/st-form-field/st-form-field.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 * © 2017 Stratio Big Data Inc., Sucursal en España.
 *
 * This software is licensed under the Apache License, Version 2.0.
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the terms of the License for more details.
 *
 * SPDX-License-Identifier: Apache-2.0.
 */
import { ChangeDetectionStrategy, Component, EventEmitter, forwardRef, HostBinding, Input, Output, ViewChild } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR, NgModel } from '@angular/forms';
import { StEgeo, StRequired } from '../../decorators/require-decorators';
let StFormFieldComponent = StFormFieldComponent_1 = class StFormFieldComponent {
    constructor() {
        this.required = false;
        this.showTooltip = true;
        // number of characters from witch inputs will be displayed as textarea
        this.valueChange = new EventEmitter();
        this.blur = new EventEmitter();
        this.disabled = false; // To check disable
        // To check disable
        this.focus = false;
        this.errorMessage = undefined;
        this._defaultErrorMessages = {
            generic: 'Error',
            required: 'This field is required',
            minLength: 'The field min length is ',
            maxLength: 'The field max length is ',
            min: 'The number has to be higher than ',
            max: 'The number has to be minor than ',
            pattern: 'Invalid value'
        };
        this.onChange = (/**
         * @param {?} _
         * @return {?}
         */
        (_) => {
        });
        this.onTouched = (/**
         * @return {?}
         */
        () => {
        });
    }
    /**
     * @return {?}
     */
    get readOnly() {
        return this.schema && this.schema.value && this.schema.value.readOnly === true;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    setValue(value) {
        this.onChange(value);
        this.valueChange.emit(value);
    }
    /**
     * @param {?} control
     * @return {?}
     */
    validate(control) {
        if (this.templateModel && this.templateModel.control && this.templateModel.control.validator) {
            return this.templateModel.control.validator(control);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.schema.value && this.schema.value.enum) {
            this.selectOptions = this.getSelectOptions();
        }
        this._loadErrorMessages();
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.default !== undefined && (this.innerValue === undefined || this.innerValue === null)) {
                this.innerValue = this.default;
                this.onChange(this.innerValue);
            }
            if (this.schema.value.readOnly) {
                this.setDisabledState(true);
            }
        }));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.schema) {
            this.selectOptions = this.getSelectOptions();
        }
    }
    /**
     * @return {?}
     */
    get type() {
        switch (this.schema.value.type) {
            case 'string':
                if (!this.schema.value.enum) {
                    return 'text';
                }
                else {
                    return 'select';
                }
            case 'integer':
                return 'number';
            default:
                return (/** @type {?} */ (this.schema.value.type));
        }
    }
    /**
     * @return {?}
     */
    get min() {
        return this.schema.value.exclusiveMinimum ? this.schema.value.minimum + this.getInputStep() : this.schema.value.minimum;
    }
    /**
     * @return {?}
     */
    get max() {
        return this.schema.value.exclusiveMaximum ? this.schema.value.maximum - this.getInputStep() : this.schema.value.maximum;
    }
    /**
     * @return {?}
     */
    get label() {
        return this.schema.value.title;
    }
    /**
     * @return {?}
     */
    get placeholder() {
        return this.schema.value.examples && this.schema.value.examples[0] ? this.schema.value.examples[0] : '';
    }
    /**
     * @return {?}
     */
    get default() {
        return this.schema.value.default;
    }
    /**
     * @return {?}
     */
    get description() {
        if (this.showTooltip) {
            return this.schema.value.description;
        }
        else {
            return undefined;
        }
    }
    /**
     * @return {?}
     */
    get minLength() {
        return this.schema.value.minLength;
    }
    /**
     * @return {?}
     */
    get maxLength() {
        return this.schema.value.maxLength;
    }
    /**
     * @return {?}
     */
    get pattern() {
        return this.schema.value.pattern;
    }
    /**
     * @param {?} type
     * @return {?}
     */
    hasType(type) {
        switch (type) {
            case 'input':
                return this.type === 'text' || this.type === 'number' || this.type === 'integer';
            case 'switch':
                return this.type === 'boolean' && this.hasDependencies;
            case 'checkbox':
                return this.type === 'boolean' && !this.hasDependencies;
            default:
                return this.type === type;
        }
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        this.innerValue = value;
        this.valueChange.emit(value);
        this.onChange(value);
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    /**
     * @param {?} disable
     * @return {?}
     */
    setDisabledState(disable) {
        if (this.templateModel && this.templateModel.control) {
            if (disable) {
                this.templateModel.control.disable();
            }
            else {
                this.templateModel.control.enable();
            }
        }
    }
    /**
     * @return {?}
     */
    getInputStep() {
        if (this.schema.value.type === 'number') {
            return 0.1;
        }
        else {
            return 1;
        }
    }
    /**
     * @return {?}
     */
    getSelectOptions() {
        /** @type {?} */
        let options = [];
        if (this.schema.value.enum) {
            options.push((/** @type {?} */ ({ label: 'Select one option', value: undefined })));
            /** @type {?} */
            let enumValues = (/** @type {?} */ (this.schema.value.enum));
            enumValues.forEach((/**
             * @param {?} value
             * @return {?}
             */
            (value) => {
                options.push((/** @type {?} */ ({ label: value, value: value })));
            }));
        }
        return options;
    }
    /**
     * @return {?}
     */
    onBlur() {
        this.blur.emit();
    }
    /**
     * @private
     * @return {?}
     */
    _loadErrorMessages() {
        this.errors = {
            required: (this.errorMessages && this.errorMessages.required) || this._defaultErrorMessages.required,
            pattern: (this.errorMessages && this.errorMessages.pattern) || this._defaultErrorMessages.pattern,
            generic: (this.errorMessages && this.errorMessages.generic) || this._defaultErrorMessages.generic,
            minLength: ((this.errorMessages && this.errorMessages.minLength) || this._defaultErrorMessages.minLength) + this.schema.value.minLength,
            maxLength: ((this.errorMessages && this.errorMessages.maxLength) || this._defaultErrorMessages.maxLength) + this.schema.value.maxLength,
            min: ((this.errorMessages && this.errorMessages.min) || this._defaultErrorMessages.min) + (this.min - this.getInputStep()),
            max: ((this.errorMessages && this.errorMessages.max) || this._defaultErrorMessages.max) + (this.max + this.getInputStep())
        };
    }
};
StFormFieldComponent.decorators = [
    { type: Component, args: [{
                selector: 'st-form-field',
                template: "<!--\n\n    \u00A9 2017 Stratio Big Data Inc., Sucursal en Espa\u00F1a.\n\n    This software is licensed under the Apache License, Version 2.0.\n    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n    See the terms of the License for more details.\n\n    SPDX-License-Identifier: Apache-2.0.\n\n-->\n\n<st-input *ngIf=\"hasType('input') && (!maxWidth || (!maxLength || maxLength < maxWidth) && (!minLength || minLength < maxWidth))\"\n          #templateModel=\"ngModel\"\n          [forceValidations]=\"forceValidations\"\n          [fieldType]=\"type\"\n          [label]=\"label\"\n          [name]=\"schema.key\"\n          [placeholder]=\"placeholder\"\n          [ngModel]=\"innerValue\"\n          (ngModelChange)=\"setValue($event)\"\n          [contextualHelp]=\"description\"\n          [errors]=\"errors\"\n          [default]=\"default\"\n          [max]=\"max\"\n          [min]=\"min\"\n          [minlength]=\"minLength\"\n          [maxlength]=\"maxLength\"\n          [required]=\"required\"\n          [pattern]=\"pattern\"\n          [step]=\"getInputStep()\"\n          [qaTag]=\"qaTag\"\n          (blur)=\"onBlur()\">\n</st-input>\n\n<st-textarea *ngIf=\"hasType('input') && maxWidth && (maxLength >= maxWidth || minLength >= maxWidth)\"\n          #templateModel=\"ngModel\"\n          [label]=\"label\"\n          [name]=\"schema.key\"\n          [default]=\"default\"\n          [placeholder]=\"placeholder\"\n          [ngModel]=\"innerValue\"\n          (ngModelChange)=\"setValue($event)\"\n          [contextualHelp]=\"description\"\n          [errors]=\"errors\"\n          [minlength]=\"minLength\"\n          [maxlength]=\"maxLength\"\n          [required]=\"required\"\n          [pattern]=\"pattern\"\n          [qaTag]=\"qaTag\"\n          (blur)=\"onBlur()\">\n</st-textarea>\n\n<st-checkbox *ngIf=\"hasType('checkbox')\"\n             #templateModel=\"ngModel\"\n             [ngModel]=\"innerValue\"\n             (ngModelChange)=\"setValue($event)\"\n             [checked]=\"innerValue\"\n             [value]=\"innerValue\"\n             [name]=\"schema.key\"\n             [contextualHelp]=\"description\"\n             [qaTag]=\"qaTag\"><span>{{schema.value.title}}</span>\n</st-checkbox>\n\n<st-select *ngIf=\"hasType('select')\"\n           #templateModel=\"ngModel\"\n           [label]=\"label\"\n           [tooltip]=\"description\"\n           [name]=\"schema.key\"\n           [placeholder]=\"placeholder\"\n           [default]=\"default\"\n           [options]=\"selectOptions\"\n           [ngModel]=\"innerValue\"\n           (ngModelChange)=\"setValue($event)\"\n           [required]=\"required\"\n           [id]=\"qaTag\">\n</st-select>\n\n<st-switch *ngIf=\"hasType('switch')\"\n           #templateModel=\"ngModel\"\n           [label]=\"schema.value.title\"\n           [name]=\"schema.key\"\n           [contextualHelp]=\"description\"\n           [ngModel]=\"innerValue\"\n           (ngModelChange)=\"setValue($event)\"\n           [value]=\"innerValue\"\n           [qaTag]=\"schema.key\"\n           [id]=\"qaTag\">\n</st-switch>\n",
                providers: [
                    { provide: NG_VALUE_ACCESSOR, useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => StFormFieldComponent_1)), multi: true },
                    { provide: NG_VALIDATORS, useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => StFormFieldComponent_1)), multi: true }
                ],
                changeDetection: ChangeDetectionStrategy.OnPush,
                host: {
                    class: 'st-form-field'
                },
                styles: ["@charset \"UTF-8\";"]
            }] }
];
StFormFieldComponent.propDecorators = {
    schema: [{ type: Input }],
    required: [{ type: Input }],
    errorMessages: [{ type: Input }],
    qaTag: [{ type: Input }],
    name: [{ type: Input }],
    value: [{ type: Input }],
    hasDependencies: [{ type: Input }],
    forceValidations: [{ type: Input }],
    showTooltip: [{ type: Input }],
    maxWidth: [{ type: Input }],
    valueChange: [{ type: Output }],
    blur: [{ type: Output }],
    templateModel: [{ type: ViewChild, args: ['templateModel', { static: false },] }],
    readOnly: [{ type: HostBinding, args: ['class.read-only',] }]
};
tslib_1.__decorate([
    StRequired(),
    tslib_1.__metadata("design:type", Object)
], StFormFieldComponent.prototype, "schema", void 0);
StFormFieldComponent = StFormFieldComponent_1 = tslib_1.__decorate([
    StEgeo()
], StFormFieldComponent);
export { StFormFieldComponent };
if (false) {
    /** @type {?} */
    StFormFieldComponent.prototype.schema;
    /** @type {?} */
    StFormFieldComponent.prototype.required;
    /** @type {?} */
    StFormFieldComponent.prototype.errorMessages;
    /** @type {?} */
    StFormFieldComponent.prototype.qaTag;
    /** @type {?} */
    StFormFieldComponent.prototype.name;
    /** @type {?} */
    StFormFieldComponent.prototype.value;
    /** @type {?} */
    StFormFieldComponent.prototype.hasDependencies;
    /** @type {?} */
    StFormFieldComponent.prototype.forceValidations;
    /** @type {?} */
    StFormFieldComponent.prototype.showTooltip;
    /** @type {?} */
    StFormFieldComponent.prototype.maxWidth;
    /** @type {?} */
    StFormFieldComponent.prototype.valueChange;
    /** @type {?} */
    StFormFieldComponent.prototype.blur;
    /** @type {?} */
    StFormFieldComponent.prototype.templateModel;
    /** @type {?} */
    StFormFieldComponent.prototype.disabled;
    /** @type {?} */
    StFormFieldComponent.prototype.focus;
    /** @type {?} */
    StFormFieldComponent.prototype.errorMessage;
    /** @type {?} */
    StFormFieldComponent.prototype.selectOptions;
    /** @type {?} */
    StFormFieldComponent.prototype.innerValue;
    /** @type {?} */
    StFormFieldComponent.prototype.errors;
    /**
     * @type {?}
     * @private
     */
    StFormFieldComponent.prototype._defaultErrorMessages;
    /** @type {?} */
    StFormFieldComponent.prototype.onChange;
    /** @type {?} */
    StFormFieldComponent.prototype.onTouched;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3QtZm9ybS1maWVsZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac3RyYXRpby9lZ2VvLyIsInNvdXJjZXMiOlsibGliL3N0LWZvcm0vc3QtZm9ybS1maWVsZC9zdC1mb3JtLWZpZWxkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQVVBLE9BQU8sRUFDSix1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFlBQVksRUFDWixVQUFVLEVBQ1YsV0FBVyxFQUNYLEtBQUssRUFHTCxNQUFNLEVBRU4sU0FBUyxFQUNYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBcUMsYUFBYSxFQUFFLGlCQUFpQixFQUFFLE9BQU8sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTlHLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0scUNBQXFDLENBQUM7SUFtQjVELG9CQUFvQixrQ0FBcEIsb0JBQW9CO0lBZmpDO1FBaUJZLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFPMUIsZ0JBQVcsR0FBWSxJQUFJLENBQUM7O1FBRTNCLGdCQUFXLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDekQsU0FBSSxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBR3JELGFBQVEsR0FBWSxLQUFLLENBQUMsQ0FBQyxtQkFBbUI7O1FBQzlDLFVBQUssR0FBWSxLQUFLLENBQUM7UUFDdkIsaUJBQVksR0FBVyxTQUFTLENBQUM7UUFLdkIsMEJBQXFCLEdBQWlCO1lBQ3BELE9BQU8sRUFBRSxPQUFPO1lBQ2hCLFFBQVEsRUFBRSx3QkFBd0I7WUFDbEMsU0FBUyxFQUFFLDBCQUEwQjtZQUNyQyxTQUFTLEVBQUUsMEJBQTBCO1lBQ3JDLEdBQUcsRUFBRSxtQ0FBbUM7WUFDeEMsR0FBRyxFQUFFLGtDQUFrQztZQUN2QyxPQUFPLEVBQUUsZUFBZTtTQUMxQixDQUFDO1FBT0YsYUFBUTs7OztRQUFHLENBQUMsQ0FBTSxFQUFFLEVB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Rix3Q0FDQzs7SUFFRCx5Q0FDQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiDCqSAyMDE3IFN0cmF0aW8gQmlnIERhdGEgSW5jLiwgU3VjdXJzYWwgZW4gRXNwYcOxYS5cbiAqXG4gKiBUaGlzIHNvZnR3YXJlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZO1xuICogd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS5cbiAqIFNlZSB0aGUgdGVybXMgb2YgdGhlIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMC5cbiAqL1xuaW1wb3J0IHtcbiAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgQ29tcG9uZW50LFxuICAgRXZlbnRFbWl0dGVyLFxuICAgZm9yd2FyZFJlZixcbiAgIEhvc3RCaW5kaW5nLFxuICAgSW5wdXQsXG4gICBPbkNoYW5nZXMsXG4gICBPbkluaXQsXG4gICBPdXRwdXQsXG4gICBTaW1wbGVDaGFuZ2VzLFxuICAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIEZvcm1Db250cm9sLCBOR19WQUxJREFUT1JTLCBOR19WQUxVRV9BQ0NFU1NPUiwgTmdNb2RlbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IFN0SW5wdXRFcnJvciB9IGZyb20gJy4uLy4uL3N0LWlucHV0L3N0LWlucHV0LmVycm9yLm1vZGVsJztcbmltcG9ydCB7IFN0RWdlbywgU3RSZXF1aXJlZCB9IGZyb20gJy4uLy4uL2RlY29yYXRvcnMvcmVxdWlyZS1kZWNvcmF0b3JzJztcbmltcG9ydCB7IFN0RHJvcERvd25NZW51SXRlbSB9IGZyb20gJy4uLy4uL3N0LWRyb3Bkb3duLW1lbnUvc3QtZHJvcGRvd24tbWVudS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSlNPTlNjaGVtYTQsIEpTT05TY2hlbWE0VHlwZSwgSlNPTlNjaGVtYTRUeXBlTmFtZSB9IGZyb20gJ2pzb24tc2NoZW1hJztcblxuQFN0RWdlbygpXG5AQ29tcG9uZW50KHtcbiAgIHNlbGVjdG9yOiAnc3QtZm9ybS1maWVsZCcsXG4gICB0ZW1wbGF0ZVVybDogJy4vc3QtZm9ybS1maWVsZC5jb21wb25lbnQuaHRtbCcsXG4gICBzdHlsZVVybHM6IFsnLi9zdC1mb3JtLWZpZWxkLmNvbXBvbmVudC5zY3NzJ10sXG4gICBwcm92aWRlcnM6IFtcbiAgICAgIHsgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFN0Rm9ybUZpZWxkQ29tcG9uZW50KSwgbXVsdGk6IHRydWUgfSxcbiAgICAgIHsgcHJvdmlkZTogTkdfVkFMSURBVE9SUywgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gU3RGb3JtRmllbGRDb21wb25lbnQpLCBtdWx0aTogdHJ1ZSB9XG4gICBdLFxuICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gICBob3N0OiB7XG4gICAgICBjbGFzczogJ3N0LWZvcm0tZmllbGQnXG4gICB9XG59KVxuXG5leHBvcnQgY2xhc3MgU3RGb3JtRmllbGRDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25Jbml0LCBPbkNoYW5nZXMge1xuICAgQElucHV0KCkgQFN0UmVxdWlyZWQoKSBzY2hlbWE6IHsga2V5OiBzdHJpbmcsIHZhbHVlOiBKU09OU2NoZW1hNCB9O1xuICAgQElucHV0KCkgcmVxdWlyZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgIEBJbnB1dCgpIGVycm9yTWVzc2FnZXM6IFN0SW5wdXRFcnJvcjtcbiAgIEBJbnB1dCgpIHFhVGFnOiBzdHJpbmc7XG4gICBASW5wdXQoKSBuYW1lOiBzdHJpbmc7XG4gICBASW5wdXQoKSB2YWx1ZTogYW55O1xuICAgQElucHV0KCkgaGFzRGVwZW5kZW5jaWVzOiBib29sZWFuO1xuICAgQElucHV0KCkgZm9yY2VWYWxpZGF0aW9uczogYm9vbGVhbjtcbiAgIEBJbnB1dCgpIHNob3dUb29sdGlwOiBib29sZWFuID0gdHJ1ZTtcbiAgIEBJbnB1dCgpIG1heFdpZHRoOiBudW1iZXI7IC8vIG51bWJlciBvZiBjaGFyYWN0ZXJzIGZyb20gd2l0Y2ggaW5wdXRzIHdpbGwgYmUgZGlzcGxheWVkIGFzIHRleHRhcmVhXG4gICBAT3V0cHV0KCkgdmFsdWVDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICBAT3V0cHV0KCkgYmx1cjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgIEBWaWV3Q2hpbGQoJ3RlbXBsYXRlTW9kZWwnLCB7IHN0YXRpYzogZmFsc2UgfSkgdGVtcGxhdGVNb2RlbDogTmdNb2RlbDtcblxuICAgcHVibGljIGRpc2FibGVkOiBib29sZWFuID0gZmFsc2U7IC8vIFRvIGNoZWNrIGRpc2FibGVcbiAgIHB1YmxpYyBmb2N1czogYm9vbGVhbiA9IGZhbHNlO1xuICAgcHVibGljIGVycm9yTWVzc2FnZTogc3RyaW5nID0gdW5kZWZpbmVkO1xuICAgcHVibGljIHNlbGVjdE9wdGlvbnM6IFN0RHJvcERvd25NZW51SXRlbVtdO1xuICAgcHVibGljIGlubmVyVmFsdWU6IGFueTtcbiAgIHB1YmxpYyBlcnJvcnM6IFN0SW5wdXRFcnJvcjtcblxuICAgcHJpdmF0ZSByZWFkb25seSBfZGVmYXVsdEVycm9yTWVzc2FnZXM6IFN0SW5wdXRFcnJvciA9IHtcbiAgICAgIGdlbmVyaWM6ICdFcnJvcicsXG4gICAgICByZXF1aXJlZDogJ1RoaXMgZmllbGQgaXMgcmVxdWlyZWQnLFxuICAgICAgbWluTGVuZ3RoOiAnVGhlIGZpZWxkIG1pbiBsZW5ndGggaXMgJyxcbiAgICAgIG1heExlbmd0aDogJ1RoZSBmaWVsZCBtYXggbGVuZ3RoIGlzICcsXG4gICAgICBtaW46ICdUaGUgbnVtYmVyIGhhcyB0byBiZSBoaWdoZXIgdGhhbiAnLFxuICAgICAgbWF4OiAnVGhlIG51bWJlciBoYXMgdG8gYmUgbWlub3IgdGhhbiAnLFxuICAgICAgcGF0dGVybjogJ0ludmFsaWQgdmFsdWUnXG4gICB9O1xuXG4gICBASG9zdEJpbmRpbmcoJ2NsYXNzLnJlYWQtb25seScpXG4gICBnZXQgcmVhZE9ubHkoKTogYm9vbGVhbiB7XG4gICAgICByZXR1cm4gdGhpcy5zY2hlbWEgJiYgdGhpcy5zY2hlbWEudmFsdWUgJiYgdGhpcy5zY2hlbWEudmFsdWUucmVhZE9ubHkgPT09IHRydWU7XG4gICB9XG5cbiAgIG9uQ2hhbmdlID0gKF86IGFueSkgPT4ge1xuICAgfVxuXG4gICBvblRvdWNoZWQgPSAoKSA9PiB7XG4gICB9XG5cbiAgIHNldFZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICAgIHRoaXMub25DaGFuZ2UodmFsdWUpO1xuICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHZhbHVlKTtcbiAgIH1cblxuICAgdmFsaWRhdGUoY29udHJvbDogRm9ybUNvbnRyb2wpOiBhbnkge1xuICAgICAgaWYgKHRoaXMudGVtcGxhdGVNb2RlbCAmJiB0aGlzLnRlbXBsYXRlTW9kZWwuY29udHJvbCAmJiB0aGlzLnRlbXBsYXRlTW9kZWwuY29udHJvbC52YWxpZGF0b3IpIHtcbiAgICAgICAgIHJldHVybiB0aGlzLnRlbXBsYXRlTW9kZWwuY29udHJvbC52YWxpZGF0b3IoY29udHJvbCk7XG4gICAgICB9XG4gICB9XG5cbiAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgaWYgKHRoaXMuc2NoZW1hLnZhbHVlICYmIHRoaXMuc2NoZW1hLnZhbHVlLmVudW0pIHtcbiAgICAgICAgIHRoaXMuc2VsZWN0T3B0aW9ucyA9IHRoaXMuZ2V0U2VsZWN0T3B0aW9ucygpO1xuICAgICAgfVxuICAgICAgdGhpcy5fbG9hZEVycm9yTWVzc2FnZXMoKTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgaWYgKHRoaXMuZGVmYXVsdCAhPT0gdW5kZWZpbmVkICYmICh0aGlzLmlubmVyVmFsdWUgPT09IHVuZGVmaW5lZCB8fCB0aGlzLmlubmVyVmFsdWUgPT09IG51bGwpKSB7XG4gICAgICAgICAgICB0aGlzLmlubmVyVmFsdWUgPSB0aGlzLmRlZmF1bHQ7XG4gICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKHRoaXMuaW5uZXJWYWx1ZSk7XG4gICAgICAgICB9XG4gICAgICAgICBpZiAodGhpcy5zY2hlbWEudmFsdWUucmVhZE9ubHkpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGlzYWJsZWRTdGF0ZSh0cnVlKTtcbiAgICAgICAgIH1cbiAgICAgIH0pO1xuICAgfVxuXG4gICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgICAgaWYgKGNoYW5nZXMuc2NoZW1hKSB7XG4gICAgICAgICB0aGlzLnNlbGVjdE9wdGlvbnMgPSB0aGlzLmdldFNlbGVjdE9wdGlvbnMoKTtcbiAgICAgIH1cbiAgIH1cblxuXG4gICBnZXQgdHlwZSgpOiBzdHJpbmcge1xuICAgICAgc3dpdGNoICh0aGlzLnNjaGVtYS52YWx1ZS50eXBlKSB7XG4gICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgaWYgKCF0aGlzLnNjaGVtYS52YWx1ZS5lbnVtKSB7XG4gICAgICAgICAgICAgICByZXR1cm4gJ3RleHQnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgIHJldHVybiAnc2VsZWN0JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgIGNhc2UgJ2ludGVnZXInOlxuICAgICAgICAgICAgcmV0dXJuICdudW1iZXInO1xuICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiA8SlNPTlNjaGVtYTRUeXBlTmFtZT4gdGhpcy5zY2hlbWEudmFsdWUudHlwZTtcbiAgICAgIH1cbiAgIH1cblxuICAgZ2V0IG1pbigpOiBudW1iZXIge1xuICAgICAgcmV0dXJuIHRoaXMuc2NoZW1hLnZhbHVlLmV4Y2x1c2l2ZU1pbmltdW0gPyB0aGlzLnNjaGVtYS52YWx1ZS5taW5pbXVtICsgdGhpcy5nZXRJbnB1dFN0ZXAoKSA6IHRoaXMuc2NoZW1hLnZhbHVlLm1pbmltdW07XG4gICB9XG5cbiAgIGdldCBtYXgoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiB0aGlzLnNjaGVtYS52YWx1ZS5leGNsdXNpdmVNYXhpbXVtID8gdGhpcy5zY2hlbWEudmFsdWUubWF4aW11bSAtIHRoaXMuZ2V0SW5wdXRTdGVwKCkgOiB0aGlzLnNjaGVtYS52YWx1ZS5tYXhpbXVtO1xuICAgfVxuXG4gICBnZXQgbGFiZWwoKTogc3RyaW5nIHtcbiAgICAgIHJldHVybiB0aGlzLnNjaGVtYS52YWx1ZS50aXRsZTtcbiAgIH1cblxuICAgZ2V0IHBsYWNlaG9sZGVyKCk6IHN0cmluZyB7XG4gICAgICByZXR1cm4gdGhpcy5zY2hlbWEudmFsdWUuZXhhbXBsZXMgJiYgdGhpcy5zY2hlbWEudmFsdWUuZXhhbXBsZXNbMF0gPyB0aGlzLnNjaGVtYS52YWx1ZS5leGFtcGxlc1swXSA6ICcnO1xuICAgfVxuXG4gICBnZXQgZGVmYXVsdCgpOiBKU09OU2NoZW1hNFR5cGUge1xuICAgICAgcmV0dXJuIHRoaXMuc2NoZW1hLnZhbHVlLmRlZmF1bHQ7XG4gICB9XG5cbiAgIGdldCBkZXNjcmlwdGlvbigpOiBzdHJpbmcge1xuICAgICAgaWYgKHRoaXMuc2hvd1Rvb2x0aXApIHtcbiAgICAgICAgIHJldHVybiB0aGlzLnNjaGVtYS52YWx1ZS5kZXNjcmlwdGlvbjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgfVxuXG4gICBnZXQgbWluTGVuZ3RoKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gdGhpcy5zY2hlbWEudmFsdWUubWluTGVuZ3RoO1xuICAgfVxuXG4gICBnZXQgbWF4TGVuZ3RoKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gdGhpcy5zY2hlbWEudmFsdWUubWF4TGVuZ3RoO1xuICAgfVxuXG4gICBnZXQgcGF0dGVybigpOiBzdHJpbmcge1xuICAgICAgcmV0dXJuIHRoaXMuc2NoZW1hLnZhbHVlLnBhdHRlcm47XG4gICB9XG5cbiAgIGhhc1R5cGUodHlwZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgIGNhc2UgJ2lucHV0JzpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICd0ZXh0JyB8fCB0aGlzLnR5cGUgPT09ICdudW1iZXInIHx8IHRoaXMudHlwZSA9PT0gJ2ludGVnZXInO1xuICAgICAgICAgY2FzZSAnc3dpdGNoJzpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICdib29sZWFuJyAmJiB0aGlzLmhhc0RlcGVuZGVuY2llcztcbiAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICdib29sZWFuJyAmJiAhdGhpcy5oYXNEZXBlbmRlbmNpZXM7XG4gICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gdHlwZTtcbiAgICAgIH1cbiAgIH1cblxuICAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgICB0aGlzLmlubmVyVmFsdWUgPSB2YWx1ZTtcbiAgICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh2YWx1ZSk7XG4gICAgICB0aGlzLm9uQ2hhbmdlKHZhbHVlKTtcbiAgIH1cblxuICAgcmVnaXN0ZXJPbkNoYW5nZShmbjogKF86IGFueSkgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgdGhpcy5vbkNoYW5nZSA9IGZuO1xuICAgfVxuXG4gICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcbiAgIH1cblxuICAgc2V0RGlzYWJsZWRTdGF0ZShkaXNhYmxlOiBib29sZWFuKTogdm9pZCB7XG4gICAgICBpZiAodGhpcy50ZW1wbGF0ZU1vZGVsICYmIHRoaXMudGVtcGxhdGVNb2RlbC5jb250cm9sKSB7XG4gICAgICAgICBpZiAoZGlzYWJsZSkge1xuICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZU1vZGVsLmNvbnRyb2wuZGlzYWJsZSgpO1xuICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVNb2RlbC5jb250cm9sLmVuYWJsZSgpO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgfVxuXG4gICBnZXRJbnB1dFN0ZXAoKTogbnVtYmVyIHtcbiAgICAgIGlmICh0aGlzLnNjaGVtYS52YWx1ZS50eXBlID09PSAnbnVtYmVyJykge1xuICAgICAgICAgcmV0dXJuIDAuMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICByZXR1cm4gMTtcbiAgICAgIH1cbiAgIH1cblxuICAgZ2V0U2VsZWN0T3B0aW9ucygpOiBTdERyb3BEb3duTWVudUl0ZW1bXSB7XG4gICAgICBsZXQgb3B0aW9uczogU3REcm9wRG93bk1lbnVJdGVtW10gPSBbXTtcbiAgICAgIGlmICh0aGlzLnNjaGVtYS52YWx1ZS5lbnVtKSB7XG4gICAgICAgICBvcHRpb25zLnB1c2goPFN0RHJvcERvd25NZW51SXRlbT4geyBsYWJlbDogJ1NlbGVjdCBvbmUgb3B0aW9uJywgdmFsdWU6IHVuZGVmaW5lZCB9KTtcbiAgICAgICAgIGxldCBlbnVtVmFsdWVzOiBzdHJpbmdbXSA9IDxzdHJpbmdbXT4gdGhpcy5zY2hlbWEudmFsdWUuZW51bTtcbiAgICAgICAgIGVudW1WYWx1ZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIG9wdGlvbnMucHVzaCg8U3REcm9wRG93bk1lbnVJdGVtPiB7IGxhYmVsOiB2YWx1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3B0aW9ucztcbiAgIH1cblxuICAgb25CbHVyKCk6IHZvaWQge1xuICAgICAgdGhpcy5ibHVyLmVtaXQoKTtcbiAgIH1cblxuICAgcHJpdmF0ZSBfbG9hZEVycm9yTWVzc2FnZXMoKTogdm9pZCB7XG4gICAgICB0aGlzLmVycm9ycyA9IHtcbiAgICAgICAgIHJlcXVpcmVkOiAodGhpcy5lcnJvck1lc3NhZ2VzICYmIHRoaXMuZXJyb3JNZXNzYWdlcy5yZXF1aXJlZCkgfHwgdGhpcy5fZGVmYXVsdEVycm9yTWVzc2FnZXMucmVxdWlyZWQsXG4gICAgICAgICBwYXR0ZXJuOiAodGhpcy5lcnJvck1lc3NhZ2VzICYmIHRoaXMuZXJyb3JNZXNzYWdlcy5wYXR0ZXJuKSB8fCB0aGlzLl9kZWZhdWx0RXJyb3JNZXNzYWdlcy5wYXR0ZXJuLFxuICAgICAgICAgZ2VuZXJpYzogKHRoaXMuZXJyb3JNZXNzYWdlcyAmJiB0aGlzLmVycm9yTWVzc2FnZXMuZ2VuZXJpYykgfHwgdGhpcy5fZGVmYXVsdEVycm9yTWVzc2FnZXMuZ2VuZXJpYyxcbiAgICAgICAgIG1pbkxlbmd0aDogKCh0aGlzLmVycm9yTWVzc2FnZXMgJiYgdGhpcy5lcnJvck1lc3NhZ2VzLm1pbkxlbmd0aCkgfHwgdGhpcy5fZGVmYXVsdEVycm9yTWVzc2FnZXMubWluTGVuZ3RoKSArIHRoaXMuc2NoZW1hLnZhbHVlLm1pbkxlbmd0aCxcbiAgICAgICAgIG1heExlbmd0aDogKCh0aGlzLmVycm9yTWVzc2FnZXMgJiYgdGhpcy5lcnJvck1lc3NhZ2VzLm1heExlbmd0aCkgfHwgdGhpcy5fZGVmYXVsdEVycm9yTWVzc2FnZXMubWF4TGVuZ3RoKSArIHRoaXMuc2NoZW1hLnZhbHVlLm1heExlbmd0aCxcbiAgICAgICAgIG1pbjogKCh0aGlzLmVycm9yTWVzc2FnZXMgJiYgdGhpcy5lcnJvck1lc3NhZ2VzLm1pbikgfHwgdGhpcy5fZGVmYXVsdEVycm9yTWVzc2FnZXMubWluKSArICh0aGlzLm1pbiAtIHRoaXMuZ2V0SW5wdXRTdGVwKCkpLFxuICAgICAgICAgbWF4OiAoKHRoaXMuZXJyb3JNZXNzYWdlcyAmJiB0aGlzLmVycm9yTWVzc2FnZXMubWF4KSB8fCB0aGlzLl9kZWZhdWx0RXJyb3JNZXNzYWdlcy5tYXgpICsgKHRoaXMubWF4ICsgdGhpcy5nZXRJbnB1dFN0ZXAoKSlcbiAgICAgIH07XG4gICB9XG59XG4iXX0=